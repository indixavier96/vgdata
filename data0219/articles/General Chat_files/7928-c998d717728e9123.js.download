"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7928],{9789:function(e,t,a){a.d(t,{A:function(){return f}});var n=a(10250),r=a(21956),l=a(47897),i=a(15751),s=a(7734);let o=(0,s.j)("flex items-center text-center cursor-pointer text-ellipsis whitespace-nowrap justify-center transition-all duration-500 border border-secondary bg-fill text-primary hover:bg-fill-hover hover:border-secondary-hover focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-secondary disabled:border-secondary-disabled disabled:bg-fill-disabled disabled:text-disabled disabled:cursor-not-allowed data-[error=true]:border-critical data-[error=true]:text-critical data-[error=true]:hover:bg-surface-critical data-[error=true]:hover:border-critical data-[error=true]:focus-visible:ring-critical",{variants:{size:{sm:"sm h-6 px-2 py-1 gap-1 text-label-xs [&>svg]:size-3 rounded-lg min-w-10 [&:has(.chip-icon-start)]:min-w-14 [&:has(.chip-icon-end)]:min-w-14 [&:has(.chip-cross)]:pr-1 [&:has(.chip-icon-start)]:pl-1 [&:has(.chip-icon-end)]:pr-1 [&:has(.chip-icon-start):has(.chip-icon-end)]:pl-1 [&:has(.chip-icon-start):has(.chip-icon-end)]:pr-1 [&:has(.chip-icon-start):has(.chip-cross)]:pl-1 [&:has(.chip-icon-start):has(.chip-cross)]:pr-1",md:"md h-7 px-2 py-1 gap-1 text-label-sm [&>svg]:size-3.5 rounded-[10px] min-w-[46px] [&:has(.chip-icon-start)]:min-w-[62px] [&:has(.chip-icon-end)]:min-w-[62px] [&:has(.chip-cross)]:pr-1 [&:has(.chip-icon-start)]:pl-1 [&:has(.chip-icon-end)]:pr-1 [&:has(.chip-icon-start):has(.chip-icon-end)]:pl-1 [&:has(.chip-icon-start):has(.chip-icon-end)]:pr-1 [&:has(.chip-icon-start):has(.chip-cross)]:pl-1 [&:has(.chip-icon-start):has(.chip-cross)]:pr-1",lg:"lg h-8 px-2.5 py-[5px] gap-1.5 text-label-md [&>svg]:size-4 rounded-xl min-w-[55px] [&:has(.chip-icon-start)]:min-w-[71px] [&:has(.chip-icon-end)]:min-w-[71px] [&:has(.chip-cross)]:pr-[5px] [&:has(.chip-icon-start)]:pl-1 [&:has(.chip-icon-end)]:pr-[5px] [&:has(.chip-icon-start):has(.chip-icon-end)]:pl-1 [&:has(.chip-icon-start):has(.chip-icon-end)]:pr-1 [&:has(.chip-icon-start):has(.chip-cross)]:pl-1 [&:has(.chip-icon-start):has(.chip-cross)]:pr-1",xl:"xl h-10 px-3 py-1.5 gap-2 text-label-lg [&>svg]:size-[18px] rounded-2xl min-w-[59px] [&:has(.chip-icon-start)]:min-w-[77px] [&:has(.chip-icon-end)]:min-w-[77px] [&:has(.chip-cross)]:pr-1.5 [&:has(.chip-icon-start)]:pl-3 [&:has(.chip-icon-end)]:pr-1.5 [&:has(.chip-icon-start):has(.chip-icon-end)]:pl-3 [&:has(.chip-icon-start):has(.chip-icon-end)]:pr-1.5 [&:has(.chip-icon-start):has(.chip-cross)]:pl-3 [&:has(.chip-icon-start):has(.chip-cross)]:pr-3",none:""}},defaultVariants:{size:"md"}}),d="flex items-center justify-center [.xs_&]:size-3 [.sm_&]:size-3.5 [.md_&]:size-4 [.lg_&]:size-[18px]",c=(0,s.j)("flex items-center justify-center shrink-0 transition-all duration-500 hover:bg-fill-tertiary data-[error=true]:text-critical data-[error=true]:hover:bg-fill-secondary",{variants:{size:{sm:"p-0.5 rounded-sm [&>svg]:size-3",md:"p-[3px] rounded-md [&>svg]:size-3.5",lg:"p-[3px] rounded-lg [&>svg]:size-4",xl:"p-[5px] rounded-[10px] [&>svg]:size-[18px]"}},defaultVariants:{size:"md"}}),u=e=>{let{startIcon:t,className:a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("chip-icon-start",d,a),children:t})},p=e=>{let{endIcon:t,onClick:a,className:r}=e;return(0,n.jsx)("button",{className:(0,i.cn)("chip-icon-end",d,r),onClick:a,type:"button",children:t})},m=e=>{let{size:t,error:a,onClick:r,className:s,...o}=e;return(0,n.jsx)("button",{className:(0,i.cn)("chip-cross",c({size:t}),s),onClick:e=>{e.stopPropagation(),null==r||r(e)},"data-error":a,type:"button","aria-label":"Remove",...o,children:(0,n.jsx)(l.b,{})})},h=(0,r.forwardRef)((e,t)=>{let{className:a,size:r,children:l,crossable:s,onCrossClick:d,error:c,...u}=e;return(0,n.jsxs)("button",{className:(0,i.cn)(o({size:r,className:a})),ref:t,"data-error":c,...u,type:"button",children:[l,s&&(0,n.jsx)(m,{size:"none"===r?void 0:r,error:c,onClick:d})]})});h.displayName="ChipRoot",u.displayName="ChipStartIcon",p.displayName="ChipEndIcon",m.displayName="ChipCross";let f={Root:h,StartIcon:u,EndIcon:p,Cross:m}},37053:function(e,t,a){a.d(t,{i:function(){return l}});var n=a(10250),r=a(15751);let l=e=>{let{className:t}=e;return(0,n.jsx)("hr",{className:(0,r.cn)("w-full border-primary",t)})}},70610:function(e,t,a){a.d(t,{W:function(){return u}});var n=a(10250),r=a(80265),l=a(84330),i=a(64323),s=a(15751);let o=["data-[left-scroll=true]:[mask-image:linear-gradient(270deg,#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]","data-[right-scroll=true]:[mask-image:linear-gradient(90deg,#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]","data-[left-right-scroll=true]:[mask-image:linear-gradient(to_right,#000,#000,transparent_0,#000_var(--scroll-shadow-size),#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]"];var d=a(21956);let c=()=>{let[e,t]=(0,d.useState)("right"),a=(0,d.useRef)(null);return{visibility:e,setVisibility:t,scrollContainerRef:a,handleScrollButtonClick:e=>{a.current&&a.current.scrollBy({left:"left"===e?-200:200,behavior:"smooth"})}}},u=e=>{let{children:t,className:a,...d}=e,{visibility:u,setVisibility:p,scrollContainerRef:m,handleScrollButtonClick:h}=c();return(0,n.jsxs)("div",{className:"relative w-full",children:[("left"===u||"both"===u)&&(0,n.jsx)("button",{type:"button",onClick:()=>h("left"),className:"absolute -left-6 bottom-0 top-0 flex items-center","aria-label":"Scroll left",children:(0,n.jsx)(l.w,{className:"size-6 text-primary"})}),(0,n.jsx)(r.o,{ref:m,onVisibilityChange:e=>p(e),visibility:u,orientation:"horizontal",className:(0,s.cn)("overflow-x-auto scrollbar-none",a,o),...d,children:t}),("right"===u||"both"===u)&&(0,n.jsx)("button",{type:"button",onClick:()=>h("right"),className:"absolute -right-6 bottom-0 top-0 flex items-center","aria-label":"Scroll right",children:(0,n.jsx)(i.X,{className:"size-6 text-primary"})})]})}},57956:function(e,t,a){a.d(t,{YW:function(){return g},mQ:function(){return p},nU:function(){return f},dr:function(){return m},SP:function(){return h}});var n=a(10250),r=a(95767),l=a(82861),i=a(21956),s=a(70610),o=a(15751),d=a(7734);let c=(0,d.j)("inline-flex items-center justify-center px-1",{variants:{size:{sm:"h-9 gap-1 rounded-[10px]",md:"h-10 gap-1.5 rounded-xl",lg:"h-12 gap-2 rounded-2xl"}},defaultVariants:{size:"md"}}),u=(0,d.j)("group relative inline-flex h-full flex-col items-center justify-center whitespace-nowrap border border-secondary text-secondary transition-all duration-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary disabled:border-secondary-disabled disabled:text-secondary-disabled disabled:pointer-events-none",{variants:{size:{sm:"h-7 px-2 py-1.5 text-label-sm rounded-[10px] gap-1",md:"h-8 px-3 py-1.5 text-label-md rounded-xl gap-1.5",lg:"h-10 px-4 py-2.5 text-label-lg rounded-2xl gap-2"},variant:{brand:"hover:border-transparent hover:bg-fill-secondary hover:text-primary data-[state=active]:border-transparent data-[state=active]:bg-fill-brand data-[state=active]:text-inverse-fixed",primary:"hover:border-transparent hover:bg-fill-secondary hover:text-primary data-[state=active]:border-transparent data-[state=active]:bg-fill-inverse data-[state=active]:text-inverse-fixed",secondary:"hover:bg-fill hover:text-primary data-[state=active]:bg-fill-secondary data-[state=active]:text-primary","secondary-variant":"hover:border-transparent hover:bg-fill-secondary hover:text-primary data-[state=active]:border-transparent data-[state=active]:bg-fill-tertiary data-[state=active]:text-primary"}},defaultVariants:{size:"md",variant:"primary"}}),p=r.fC,m=(0,i.forwardRef)((e,t)=>{let{className:a,size:l,...i}=e;return(0,n.jsx)(s.W,{hideScrollBar:!0,size:40,children:(0,n.jsx)("div",{className:"mx-auto w-full",children:(0,n.jsx)(r.aV,{ref:t,className:(0,o.cn)(c({size:l}),a),...i})})})});m.displayName=r.aV.displayName;let h=(0,i.forwardRef)((e,t)=>{let{className:a,size:l,variant:i,children:s,startSlot:d,endSlot:c,...p}=e;return(0,n.jsxs)(r.xz,{ref:t,className:(0,o.cn)(u({size:l,variant:i}),"flex-row items-center gap-2",a),...p,children:[d&&(0,n.jsx)("span",{className:"relative",children:d}),s&&(0,n.jsx)("span",{className:"relative",children:s}),c&&(0,n.jsx)("span",{className:"relative",children:c})]})});h.displayName=r.xz.displayName;let f=(0,i.forwardRef)((e,t)=>{let{className:a,...l}=e;return(0,n.jsx)(r.VY,{ref:t,className:(0,o.cn)("focus-visible:outline-none",a),...l})});f.displayName=r.VY.displayName;let g=(0,i.forwardRef)((e,t)=>{let{className:a,children:i,isActive:s=!1,layoutId:d,activeProps:c={},startSlot:p,endSlot:m,size:h="md",variant:f="primary",...g}=e,{className:b,...y}=c;return(0,n.jsxs)(r.xz,{ref:t,className:(0,o.cn)(u({size:h,variant:f}),a),...g,children:[s&&(0,n.jsx)(l.E.span,{layoutId:d,transition:{type:"spring",bounce:0,duration:.5},className:(0,o.cn)("absolute inset-0",(()=>{switch(f){case"brand":return"bg-inverse-fixed text-primary";case"primary":default:return"bg-surface-elevated text-primary";case"secondary":return"bg-fill-tertiary-active text-primary";case"secondary-variant":return"bg-fill-active text-primary"}})(),"sm"===h&&"rounded-[10px]","md"===h&&"rounded-xl","lg"===h&&"rounded-2xl",a),...y}),p&&(0,n.jsx)("span",{className:"relative",children:p}),(0,n.jsx)("span",{className:"relative",children:i}),m&&(0,n.jsx)("span",{className:"relative",children:m})]})});g.displayName=r.xz.displayName},89274:function(e,t,a){var n,r;a.d(t,{SY:function(){return i},VA:function(){return s},pm:function(){return l},rT:function(){return n}});let l=[{label:"Fit",value:0},{label:"25",value:.15},{label:"50",value:.3},{label:"100",value:1},{label:"150",value:1.5},{label:"200",value:2}];(r=n||(n={})).PDF="pdf",r.HTML="html";let i=["b","i","u","a","c","v","x"],s='<div style="padding: 60px 5rem; font-family: Arial;"></div>'},33384:function(e,t,a){var n,r,l,i;a.d(t,{J:function(){return r},O:function(){return n}}),(l=n||(n={})).BOLD_USED="boldUsed",l.ITALIC_USED="italicUsed",l.UNDERLINE_USED="underlineUsed",l.STRIKETHROUGH_USED="strikethroughUsed",l.INCREASE_INDENT="increaseIndent",l.DECREASE_INDENT="decreaseIndent",l.HYPERLINK_USED="hyperlinkUsed",l.IMAGE_UPLOAD_USED="imageUploadUsed",l.TABLE_INSERT="tableInsert",l.TABLE_OPTIONS_USED="tableOptionsUsed",(i=r||(r={})).ZOOM_USED="zoomUsed",i.FONT_FAMILY_USED="fontUsed",i.FONT_SIZE="fontSize",i.PARAGRAPH_ALIGNMENT="paragraphAlignment",i.LIST_USED="listUsed",i.LINE_HEIGHT="lineHeight",i.MARGIN="margin",i.TABLE_SIZE="tableSize",i.QUICK_ACTIONS="quickActions",i.TABLE_OPTIONS="tableOptions"},37266:function(e,t,a){a.d(t,{e:function(){return Y},f:function(){return q}});var n=a(10250),r=a(20273),l=a(57331),i=a(21956),s=a(80950),o=a(61206),d=a(56543),c=a(4206),u=a(51846),p=a(63856),m=a(89274),h=a(28886),f=a(21222),g=a(43192),b=a(1820),y=a(3874),v=a(85119),_=a(47451),S=a(32360),T=a(38126),A=a(57676),x=a(16246),w=a(16522),E=a(10797);let O=e=>{let{id:t,systemMessage:a,initialMessages:n=[],contextWindow:r=9,setContent:l,tools:s}=e,[o,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)([]),[p,m]=(0,i.useState)(),[h,f]=(0,i.useState)(A.d.TOKEN),[g,b]=(0,i.useState)(!1),[y,v]=(0,i.useState)(null),[_,S]=(0,i.useState)(t),[T,O]=(0,i.useState)(null),[C,L]=(0,i.useState)(!1),{refetch:N}=(0,w.X)(),I=(0,i.useMemo)(()=>r%2==0?r+1:r,[r]),M=(0,i.useRef)(new AbortController),k=(0,i.useCallback)(e=>{let{newMessages:t,replace:a=!1}=e;u(e=>a?t:[...e,...t])},[]);t!==_&&(k({newMessages:n,replace:!0}),M.current.abort(),d(!1),m(void 0),S(t),O(null),b(!1),v(null),L(!1));let H=(0,i.useCallback)(async e=>{let{updatedMessages:t,htmlDocument:n,isChatMode:r,ephemeral:i=!1}=e;d(!0),O(null),b(!1),v(null),L(i),M.current.abort(),M.current=new AbortController;let o={id:"",content:{reasoning:"",token:"",citation:[],citation_video:[],tool_call:{},email_block:"",hand_off:"",tool_result:{web_results:[],image_results:[],video_results:[],related_searches:[],structure:[],plan:[],docsScrapper:[],docsRag:[]}},role:"assistant"};i||m(o);try{let e=await (0,E.XY)({id:_,messages:t,systemMessage:a,controller:M.current,htmlDocument:n,tools:s,isChatMode:r,ephemeral:i}),d=await (0,E.LZ)({setContent:l,reader:e,currentMessage:o,setCurrentContentType:f,setCurrentMessage:m,setHasToolCallAfterToken:b,setCurrentToolName:v,controller:M.current,tools:s});if(!d.content)throw Error("Message response is empty");i||k({newMessages:[d],replace:!1})}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;O(e instanceof Error?e.message:"An error occurred while sending the message")}finally{m(void 0),d(!1),b(!1),v(null),L(!1)}},[_,a,k,f,l,s]),D=(0,i.useCallback)(async(e,t,a,n)=>{let r=[...c,{...e}];n||k({newMessages:r,replace:!0}),await H({updatedMessages:r.slice(-I),htmlDocument:t,isChatMode:a,ephemeral:n}),N()},[k,I,H,c,N]),R=(0,i.useCallback)(()=>{M.current.abort(),d(!1),p&&p.content?k({newMessages:[p],replace:!1}):k({newMessages:[],replace:!1}),m(void 0)},[p,k]),U=(0,i.useCallback)(async e=>{let{index:t,htmlDocument:a,isChatMode:n}=e,r=c.at(t-1);if(!r||"user"!==r.role)return;let l={id:(0,x.O)(),content:r.content,role:"user"},i=[...c.slice(0,t-1),l];k({newMessages:i,replace:!0}),await H({updatedMessages:i.slice(-I),htmlDocument:a,isChatMode:n})},[k,I,H,c]),j=(0,i.useCallback)(async e=>{let{index:t,htmlDocument:a,isChatMode:n}=e,r=c.slice(0,t+1);k({newMessages:r,replace:!0}),await H({updatedMessages:r.slice(-I),htmlDocument:a,isChatMode:n})},[k,I,H,c]),P=(0,i.useCallback)(async e=>{let{messageId:t,htmlDocument:a,isChatMode:n}=e;if(o)return;let r=c.find(e=>e.id===t);if(!r)return;let l=c.findIndex(e=>e.id===t);"assistant"===r.role?await U({index:l,htmlDocument:a,isChatMode:n}):"user"===r.role&&await j({index:l,htmlDocument:a,isChatMode:n})},[o,c,U,j]);return{id:_,messages:p&&!C?[...c,p]:[...c],loading:o,currentContentType:h,currentToolName:y,hasToolCallAfterToken:g,stopMessage:R,sendMessage:D,error:T,regenerateMessage:P,appendMessages:k}};var C=a(92177),L=a(74012),N=a(38055),I=a(29354),M=a(3769),k=a(11873),H=a(12178),D=a(16517),R=a(9540),U=a(20225),j=a(62819),P=a(16888),z=a(62245),F=a(36203),B=a(2350),K=a(58129),V=a(62022),G=a(33384);let Z=()=>({zoomUsed:[],fontUsed:[],fontSize:[],boldUsed:!1,italicUsed:!1,underlineUsed:!1,strikethroughUsed:!1,paragraphAlignment:[],listUsed:[],increaseIndent:!1,decreaseIndent:!1,lineHeight:1.5,margin:[0,0,0,0],hyperlinkUsed:!1,imageUploadUsed:!1,tableInsert:!1,tableSize:[],quickActions:[],tableOptions:[],tableOptionsUsed:!1,aiDocsGenerationsCount:0,tokensConsumed:0,initialTokens:0}),W=(0,i.createContext)(void 0),Y=e=>{var t,a;let{children:A}=e,E=(0,j.m)()(e=>e.user),[Y,q]=(0,i.useState)(!1),{chatHistory:J,syncUnifiedChatHistory:X,setIsDuplicating:Q}=(0,y.o)(),[$,ee]=(0,i.useState)(!1),[et,ea]=(0,i.useState)(!1),[en,er]=(0,i.useState)(!1),{isHistoryActive:el,toolCalls:ei}=(0,U.Td)()(e=>({isHistoryActive:e.isHistoryActive,toolCalls:e.toolCalls})),{editor:es,setContent:eo,getContent:ed,getCurrentSelectionInfo:ec,setEditable:eu,setShouldOpenEditor:ep}=(0,V.W)(),[em,eh]=(0,i.useState)(null),ef=(0,i.useRef)(null),eg=(0,i.useRef)(!1),eb=(0,i.useRef)(!1),ey=(0,i.useRef)(Z()),ev=(0,i.useRef)(!1),e_=(0,i.useRef)(null),eS=(0,r.NL)(),eT=(0,l.useParams)(),eA=(0,l.useRouter)(),{setCarryForward:ex}=(0,T.H)(),{data:ew}=(0,w.X)(),eE=(0,S.N)(),{hasReachedLimit:eO,getPromptsLeft:eC}=(0,I.$)(),eL=eO(u.D.AI_DOCS),eN=(0,R.I)(e=>()=>e.openDialog(p.W.DAILY_LIMIT)),eI=(0,i.useMemo)(()=>{var e,t;return null!==(t=null===(e=eT.id)||void 0===e?void 0:e.toString())&&void 0!==t?t:(0,x.O)()},[eT.id]),eM=(0,i.useMemo)(()=>(0,F.H)({chatId:eI,chatHistory:J}),[eI,J]);(0,N.B)({feature:h.VS.AI_DOCS,title:null!==(t=null==eM?void 0:eM.title)&&void 0!==t?t:f.$w.title,description:null!==(a=null==eM?void 0:eM.summary)&&void 0!==a?a:f.$w.description});let{data:ek,refetch:eH}=(0,C.gJ)(eI,!!eM),{mutateAsync:eD}=(0,C.EK)(),{updateChatThumbnailMutation:{mutateAsync:eR}}=(0,M.x)(),eU=(0,i.useMemo)(()=>null!=ek?ek:[],[ek]),ej=(0,i.useMemo)(()=>(null==ek?void 0:ek.length)?[...ek].sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime())[0]:null,[ek]),eP=(0,_.a)(),{messages:ez,loading:eF,sendMessage:eB,stopMessage:eK,regenerateMessage:eV,error:eG,appendMessages:eZ,hasToolCallAfterToken:eW,currentToolName:eY}=O({id:eI,setContent:eo,tools:ei}),{aggregator:eq}=(0,H.O)(),{email:eJ,userId:eX,userAccountStatus:eQ,userPlanPeriod:e$,userPlan:e0}=(0,k.T)(),{deviceType:e1,page:e2,source:e6,slug:e3}=(0,v.V)(),e5=(0,i.useCallback)(e=>{let t=ey.current;"boolean"==typeof t[e]&&(t[e]=!0)},[]),e7=(0,i.useCallback)((e,t)=>{let a=ey.current;if(e===G.J.MARGIN)Object.assign(a,{[e]:t});else{if(Array.isArray(t))return;let n=a[e];Array.isArray(n)?n.includes(t)||n.push(t):Object.assign(a,{[e]:t})}},[]),e8=(0,i.useCallback)(()=>{ef.current===eI&&(ey.current=Z(),ev.current=!1)},[eI]),e9=(0,i.useCallback)(()=>{let e=ey.current;if(!(e.aiDocsGenerationsCount>0||$||e.tokensConsumed>0))return;let t=sessionStorage.getItem(c.M.AI_DOCS_INSPIRATION_USED);t&&sessionStorage.removeItem(c.M.AI_DOCS_INSPIRATION_USED);let a=sessionStorage.getItem(c.M.AI_DOCS_TEMPLATE_NAME);a&&sessionStorage.removeItem(c.M.AI_DOCS_TEMPLATE_NAME),eq.log(o.H.ai_docs_session_completed.withProperties({user_edited_doc:$,zoom_used:e.zoomUsed,font_used:e.fontUsed,font_size:e.fontSize,bold_used:e.boldUsed,italic_used:e.italicUsed,underline_used:e.underlineUsed,strikethrough_used:e.strikethroughUsed,paragraph_allignment:e.paragraphAlignment,list_used:e.listUsed,increase_indent:e.increaseIndent,decrease_indent:e.decreaseIndent,template_name:null!=a?a:"",inspiration_used:!!a,inspiration_category:a?null!=t?t:"All":"",line_height:e.lineHeight,margin:e.margin,hyperlink_used:e.hyperlinkUsed,image_upload_used:e.imageUploadUsed,table_insert:e.tableInsert,table_size:e.tableSize,quick_actions:e.quickActions,table_options:e.tableOptions,table_options_used:e.tableOptionsUsed,ai_docs_generations_count:e.aiDocsGenerationsCount,email:eJ,user_account_status:eQ,user_plan_period:e$,user_plan:e0,tokens_consumed:e.tokensConsumed,tokens_remaining:eC(u.D.AI_DOCS),device:e1,...(0,K.U)()})),ee(!1),e8()},[eq,eJ,eQ,e0,e1,eC,e8,e$,$]),e4=(0,i.useCallback)(e=>{var t;let{promptText:a,files:n,messageId:r,page_name:l,source:i,slug:s}=e,p=n.map(e=>e.mimetype.split("/").pop()).filter(e=>!!e),m=sessionStorage.getItem(c.M.AI_DOCS_INSPIRATION_USED),h=sessionStorage.getItem(c.M.AI_DOCS_TEMPLATE_NAME),f=null!==(t=null==ew?void 0:ew.tokens[u.D.AI_DOCS])&&void 0!==t?t:0;eq.log(o.H.ai_docs_generation_v1.withProperties({user_prompt_text:a,processing_error:null!=eG?eG:void 0,processing_status:eG?d.J.FAILURE:d.J.SUCCESS,no_of_files_uploaded:p.length,upload_file_type:p,upload_used:p.length>0,inspiration_used:!!h,inspiration_category:h?null!=m?m:"All":"",template_name:null!=h?h:"",chat_id:eI,message_id:r,user_id:eX,email:eJ,user_account_status:eQ,user_plan_period:e$,user_plan:e0,ai_doc_queries_remaining:f,page_name:l,source:i,slug:s,device:e1,...(0,K.U)()}))},[eq,eG,eI,eX,eJ,eQ,e$,null==ew?void 0:ew.tokens,e0,e1]),te=(0,i.useCallback)(async e=>{var t;let{prompt:a,files:n=[],sendWithSelection:r=!1,isChatModeOverride:l,ephemeral:i=!1}=e,o=ec(),d={id:(0,x.O)(),role:"user",selection_info:r?o:void 0,content:[...a?[{type:"text",text:a}]:[],...n],ephemeral:i};if(!E){let e=new URL(g.H7.DOCS,window.location.origin);ex({prompt:a,files:n,feature:h.VS.AI_DOCS,isChatMode:et}),eA.push((0,B.YF)(g.H7.AUTH,{[b.t.REDIRECT]:e.href}));return}await (0,P.UN)({logoutHandler:eP});let c=ed();eu(!1);let p=null!==(t=null==ew?void 0:ew.tokens[u.D.AI_DOCS])&&void 0!==t?t:0,m=eU.length;await eB(d,c,null!=l?l:et,i),e_.current={promptText:a,files:n,messageId:d.id,tokensBefore:p,generationsCountBefore:m,page_name:e2,source:e6,slug:e3},eE(h.VS.AI_DOCS);let f=(await eS.fetchQuery({queryKey:[L.E.GET_DOCS_REVISIONS,eI],staleTime:0})).revisions.length;eh(ej);try{(null==es?void 0:es.view.dom)&&await eR({chatId:eI,thumbnail:es.view.dom})}catch(e){}if(eT.id||eA.push("".concat(g.H7.DOCS,"/").concat(eI)),eu(!0),(0===ez.length&&0===eU.length||1===f)&&el)try{await (0,D.gf)({id:eI,messages:[d],htmlDocument:null!=c?c:""}),X()}catch(e){s.Am.error("Error saving chat title")}eM||0===ez.length||X()},[eB,eI,eT.id,eA,eP,E,ed,ec,eS,eu,ez,el,eM,X,eU.length,ex,eR,null==es?void 0:es.view.dom,ej,eE,null==ew?void 0:ew.tokens,et,e2,e6,e3]),tt=(0,i.useCallback)(async e=>{if(ez.find(t=>t.id===e)){if(eL){eN();return}await (0,P.UN)({logoutHandler:eP}),eu(!1),await eV({messageId:e,htmlDocument:ed(),isChatMode:et}),await eS.invalidateQueries({queryKey:[L.E.GET_DOCS_REVISIONS,eI]}),eu(!0),(null==es?void 0:es.view.dom)&&await eR({chatId:eI,thumbnail:es.view.dom})}},[eV,ed,eP,ez,eR,eI,null==es?void 0:es.view.dom,eS,eu,eL,eN,et]),ta=(0,i.useCallback)(async e=>{let{htmlBody:t,title:a="New Blank Revision",shouldOpenEditor:n=!0}=e||{},r=null!=t?t:ed();if(!E){let e=new URL(g.H7.DOCS,window.location.origin);ex({feature:h.VS.AI_DOCS,html:r,id:eI,title:a}),eA.push((0,B.YF)(g.H7.AUTH,{[b.t.REDIRECT]:e.href}));return}await eD({id:eI,htmlSnapshot:r,summary:a});try{await (0,D.gf)({id:eI,messages:[],htmlDocument:r})}catch(e){s.Am.error("Error saving chat title")}finally{X()}let{data:l}=await eH();if(null==l?void 0:l.length){let e=[...l].sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime())[0];eh(e),eo(e.html_snapshot||m.VA),n&&ep(!0),requestAnimationFrame(async()=>{if(null==es?void 0:es.view.dom)try{await eR({chatId:eI,thumbnail:es.view.dom})}catch(e){}finally{X()}})}eT.id||eA.push("".concat(g.H7.DOCS,"/").concat(eI))},[eI,ed,eD,eT.id,eA,eH,X,ex,E,eR,null==es?void 0:es.view.dom,eo,ep]),tn=(0,i.useCallback)(e=>{eh(e),eo((null==e?void 0:e.html_snapshot)||m.VA)},[eo]),tr=(0,i.useCallback)(async e=>{Q(!0);try{await ta({htmlBody:e,title:"Duplicate - ".concat(null==em?void 0:em.title)})}catch(e){s.Am.error("Error duplicating chat")}finally{X(),Q(!1)}},[ta,em,Q,X]),tl=(0,i.useCallback)(async()=>{try{await (0,D.L_)(eI),eZ({newMessages:[],replace:!0})}catch(e){s.Am.error("Error clearing chat memory")}},[eI,eZ]);(0,i.useEffect)(()=>{let e=null!==ef.current&&ef.current!==eI;ef.current=eI,e&&(eg.current=!1,eb.current=!1,eh(null),er(!1),eo(m.VA),ep(!1),e9())},[eI,eo,e9,ep]);let ti=(0,l.usePathname)(),ts=null==ti?void 0:ti.startsWith(g.H7.DOCS);(0,i.useEffect)(()=>{el&&!eg.current&&ts&&eI&&eM&&0===ez.length&&(async()=>{let e=await (0,D._U)(eI),t=(0,z.B)(e.messages,eo,ei);er(!0),eZ({newMessages:t,replace:!0}),eS.invalidateQueries({queryKey:[L.E.GET_DOCS_REVISIONS,eI]}),eg.current=!0})()},[eI,el,eM,ez.length,ts,eo,ei,eZ,eS]),(0,i.useEffect)(()=>{!ej||(eh(ej),eb.current||(eb.current=!0,eo(ej.html_snapshot||m.VA),en||eM||(eg.current=!0)))},[ej,eo,en,eM]),(0,i.useEffect)(()=>{if((null==ew?void 0:ew.tokens)&&!ev.current){var e;ey.current.initialTokens=null!==(e=ew.tokens[u.D.AI_DOCS])&&void 0!==e?e:0,ev.current=!0}},[null==ew?void 0:ew.tokens]),(0,i.useEffect)(()=>{if(eF||!e_.current)return;let{tokensBefore:e}=e_.current;if(null==ew?void 0:ew.tokens){var t;let a=e-(null!==(t=ew.tokens[u.D.AI_DOCS])&&void 0!==t?t:0);a>0&&(ey.current.tokensConsumed+=a),ey.current.aiDocsGenerationsCount+=1,e4(e_.current)}e_.current=null},[eF,null==ew?void 0:ew.tokens,eU.length,e4]);let to=(0,i.useMemo)(()=>({id:eI,messages:ez,loading:eF,error:eG,sendMessage:te,stopMessage:eK,regenerateMessage:tt,showSelectionInPromptBox:Y,setHasEditedDoc:ee,setShowSelectionInPromptBox:q,docRevisions:eU,currentRevision:em,setCurrentRevision:tn,createRevisionHandler:ta,flushChatHistoryHandler:tl,isChatHistory:en,hasEditedDoc:$,hasToolCallAfterToken:eW,currentToolName:eY,trackAction:e5,trackDetail:e7,logSession:e9,startDocumentSession:e8,handleDuplicateChat:tr,isChatMode:et,setIsChatMode:ea}),[eI,ez,eF,eG,te,eK,tt,Y,eU,$,ee,em,tn,ta,tl,en,eW,eY,e5,e7,e9,e8,tr,et,ea]);return(0,n.jsx)(W.Provider,{value:to,children:A})},q=()=>{let e=(0,i.useContext)(W);if(!e)throw Error("useDocsChatContext must be used within a DocsChatProvider");return e}},62022:function(e,t,a){a.d(t,{Y:function(){return ed},W:function(){return ec}});var n=a(10250),r=a(92337),l=a(43075),i=a(21956),s=a(89274);let o="border-radius: 1rem; overflow: visible; outline: none; background-color: #fff; color: #171717; width: 100%; max-width: 100%;",d=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];var c=a(41094),u=a(65661),p=a(22278),m=a(73809),h=a(31247),f=a(3081),g=a(18616),b=a(12790),y=a(55946),v=a(81822),_=a(36942),S=a(20857),T=a(33258),A=a(17900),x=a(68580);let w=a(9423).X.extend({renderHTML(e){var t,a,n,r;let{node:l,HTMLAttributes:i}=e;if(!0===i.__hadOriginalStyle){let{__hadOriginalStyle:e,...n}=i,r={};n.style&&(r.style=n.style),n.class&&(r.class=n.class),n.dataset&&"object"==typeof n.dataset&&Object.assign(r,n.dataset);let s=null!==(a=null!==(t=n.level)&&void 0!==t?t:l.attrs.level)&&void 0!==a?a:1;return["h".concat(s),r,0]}let{__hadOriginalStyle:s,...o}={...null!==(n=this.options.HTMLAttributes)&&void 0!==n?n:{},...i},d=null!==(r=l.attrs.level)&&void 0!==r?r:1;return["h".concat(d),o,0]}});var E=a(6185);let O=E.HC.extend({renderHTML(e){var t,a;let{node:n,HTMLAttributes:r}=e;if(!0===r.__hadOriginalStyle){let{__hadOriginalStyle:e,...t}=r,a={};return t.style&&(a.style=t.style),t.class&&(a.class=t.class),t.dataset&&"object"==typeof t.dataset&&Object.assign(a,t.dataset),["li",a,0]}let l=this.parent;return null!==(a=null==l?void 0:null===(t=l.renderHTML)||void 0===t?void 0:t.call(l,{node:n,HTMLAttributes:r}))&&void 0!==a?a:["li",r,0]}}),C=E.Uf.extend({renderHTML(e){var t,a;let{node:n,HTMLAttributes:r}=e;if(!0===r.__hadOriginalStyle){let{__hadOriginalStyle:e,...t}=r,a={};return t.style&&(a.style=t.style),t.class&&(a.class=t.class),t.dataset&&"object"==typeof t.dataset&&Object.assign(a,t.dataset),["li",a,0]}let l=this.parent;return null!==(a=null==l?void 0:null===(t=l.renderHTML)||void 0===t?void 0:t.call(l,{node:n,HTMLAttributes:r}))&&void 0!==a?a:["li",r,0]}}),L=E.DY.extend({renderHTML(e){var t;let{node:a,HTMLAttributes:n}=e;if(!0===n.__hadOriginalStyle){let{__hadOriginalStyle:e,...t}=n;return["ul",t,0]}let{__hadOriginalStyle:r,...l}={...null!==(t=this.options.HTMLAttributes)&&void 0!==t?t:{},...n};return["ul",l,0]}}),N=E.GS.extend({renderHTML(e){var t;let{node:a,HTMLAttributes:n}=e;if(!0===n.__hadOriginalStyle){let{__hadOriginalStyle:e,...t}=n;return["ol",t,0]}let{__hadOriginalStyle:r,...l}={...null!==(t=this.options.HTMLAttributes)&&void 0!==t?t:{},...n};return["ol",l,0]}}),I=E.ax.extend({renderHTML(e){var t;let{node:a,HTMLAttributes:n}=e;if(!0===n.__hadOriginalStyle){let{__hadOriginalStyle:e,...t}=n;return["ul",t,0]}let{__hadOriginalStyle:r,...l}={...null!==(t=this.options.HTMLAttributes)&&void 0!==t?t:{},...n};return["ul",l,0]}}),M=E.Ne.extend({addExtensions(){var e,t;let a=this.parent;return(null!==(t=null==a?void 0:null===(e=a.addExtensions)||void 0===e?void 0:e.call(a))&&void 0!==t?t:[]).map(e=>"bulletList"===e.name?L.configure({HTMLAttributes:e.options.HTMLAttributes}):"orderedList"===e.name?N.configure({HTMLAttributes:e.options.HTMLAttributes}):"taskList"===e.name?I.configure({HTMLAttributes:e.options.HTMLAttributes}):"listItem"===e.name?O.configure({HTMLAttributes:e.options.HTMLAttributes}):"taskItem"===e.name?C.configure({HTMLAttributes:e.options.HTMLAttributes}):e)}});var k=a(85587),H=a(60836);let D=function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];for(let t of a){let a=e.nodes[t];if(a)return{key:t,node:a}}return null},R=function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=D(e,"table","table_node","tableNode"),l=D(e,"table_row","tableRow","tableRowNode"),i=D(e,"table_cell","tableCell","tableCellNode"),s=D(e,"table_header","tableHeader","tableHeaderNode"),o=D(e,"paragraph","p");if(!r||!l||!i||!s||!o){let t=Object.keys(e.nodes).join(", ");throw Error("Table nodes are missing in the schema. Available node keys: ".concat(t))}let d=r.node,c=l.node,u=i.node,p=s.node,m=o.node,h=e=>(e?p:u).create({},m.create()),f=[];for(let e=0;e<t;e++){let t=n&&0===e,r=[];for(let e=0;e<a;e++)r.push(h(t));f.push(c.create({},r))}return d.create({},f)},U=H.iA.extend({renderHTML(e){let t,{node:a,HTMLAttributes:n}=e;if(!0===n.__hadOriginalStyle){let{__hadOriginalStyle:e,...a}=n,r={};a.originalAttributes&&"object"==typeof a.originalAttributes&&Object.assign(r,a.originalAttributes),a.style&&(r.style=a.style),a.class&&(r.class=a.class),a.dataset&&"object"==typeof a.dataset&&Object.assign(r,a.dataset),t=["table",r,0]}else{var r;let e=this.parent,l=null==e?void 0:null===(r=e.renderHTML)||void 0===r?void 0:r.call(e,{node:a,HTMLAttributes:n});if(l&&Array.isArray(l)&&"div"===l[0])return l;t=null!=l?l:["table",n,0]}return["div",{class:"tableWrapper"},t]}}),j=H.SC.extend({renderHTML(e){var t,a;let{node:n,HTMLAttributes:r}=e;if(!0===r.__hadOriginalStyle){let{__hadOriginalStyle:e,...t}=r,a={};return t.originalAttributes&&"object"==typeof t.originalAttributes&&Object.assign(a,t.originalAttributes),t.style&&(a.style=t.style),t.class&&(a.class=t.class),t.dataset&&"object"==typeof t.dataset&&Object.assign(a,t.dataset),["tr",a,0]}let l=this.parent;return null!==(a=null==l?void 0:null===(t=l.renderHTML)||void 0===t?void 0:t.call(l,{node:n,HTMLAttributes:r}))&&void 0!==a?a:["tr",r,0]}}),P=H.pj.extend({renderHTML(e){let{node:t,HTMLAttributes:a}=e,n=!0===a.__hadOriginalStyle,r={...this.options.HTMLAttributes||{}};if(n){let{__hadOriginalStyle:e,...t}=a;t.originalAttributes&&"object"==typeof t.originalAttributes&&Object.assign(r,t.originalAttributes),t.style&&(r.style=t.style),t.class&&(r.class=t.class),t.dataset&&"object"==typeof t.dataset&&Object.assign(r,t.dataset)}else Object.assign(r,a);return void 0!==a.colspan&&1!==a.colspan&&(r.colspan=a.colspan),void 0!==a.rowspan&&1!==a.rowspan&&(r.rowspan=a.rowspan),["td",r,0]},addAttributes(){var e;return{...null===(e=this.parent)||void 0===e?void 0:e.call(this),backgroundColor:{default:null,renderHTML:e=>e.backgroundColor?{style:"background-color: ".concat(e.backgroundColor)}:{},parseHTML:e=>e.style.backgroundColor.replace(/['"]+/g,"")}}}}),z=H.xD.extend({addAttributes(){var e;return{...null===(e=this.parent)||void 0===e?void 0:e.call(this),style:{default:null,parseHTML:e=>{let t=e.getAttribute("style")||"";if(!e.style.backgroundColor){let a=e.closest("thead");a&&a instanceof HTMLElement&&a.style.backgroundColor&&(t="background-color: ".concat(a.style.backgroundColor,"; ").concat(t))}return t||null},renderHTML:e=>e.style?{style:e.style}:{}}}},renderHTML(e){let{node:t,HTMLAttributes:a}=e,n={...this.options.HTMLAttributes||{},...a};return void 0!==a.colspan&&1!==a.colspan&&(n.colspan=a.colspan),void 0!==a.rowspan&&1!==a.rowspan&&(n.rowspan=a.rowspan),["th",n,0]}}),F=H.bZ.extend({addExtensions(){var e,t;let a=this.parent;return(null!==(t=null==a?void 0:null===(e=a.addExtensions)||void 0===e?void 0:e.call(a))&&void 0!==t?t:[]).map(e=>{if("table"===e.name){let e=this.options.table,t={};return e&&(e.HTMLAttributes&&(t.HTMLAttributes=e.HTMLAttributes),void 0!==e.allowTableNodeSelection&&(t.allowTableNodeSelection=e.allowTableNodeSelection),void 0!==e.lastColumnResizable&&(t.lastColumnResizable=e.lastColumnResizable),void 0!==e.resizable&&(t.resizable=e.resizable)),U.configure(t)}if("tableRow"===e.name){let e=this.options.tableRow;return j.configure(e?{HTMLAttributes:e.HTMLAttributes}:{})}if("tableCell"===e.name){let e=this.options.tableCell;return P.configure(e?{HTMLAttributes:e.HTMLAttributes}:{})}if("tableHeader"===e.name){let e=this.options.tableHeader;return z.configure(e?{HTMLAttributes:e.HTMLAttributes}:{})}return e})}}),B=k.hj.create({name:"conditionalTableCommands",addCommands:()=>({insertTable:function(){let{rows:e=3,cols:t=3,withHeaderRow:a=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n=>{let{editor:r,commands:l}=n,i=R(r.schema,e,t,a);return l.insertContent(i)}},deleteTable:()=>e=>{let{state:t,dispatch:a}=e,{$from:n}=t.selection,r=-1;for(let e=n.depth;e>0;e--)if("table"===n.node(e).type.name){r=e;break}if(-1===r)return!1;let l=n.node(r),i=n.before(r),s=t.tr.delete(i,i+l.nodeSize);return a&&a(s),!0}})});var K=a(28030),V=a(3735);let G=k.hj.create({name:"customDragHandle",addOptions:()=>({handleWidth:24,handleClass:"tiptap-drag-handle",draggableNodes:["paragraph","heading","listItem","blockquote","table"]}),addProseMirrorPlugins(){let{draggableNodes:e,handleClass:t,handleWidth:a}=this.options,n=null,r=null,l=!1;return[new K.Sy({key:new K.H$("custom-drag-handle"),props:{handleDOMEvents:{drop(e,t){if(null===n||!r)return!1;t.preventDefault();let a={left:t.clientX,top:t.clientY},l=e.posAtCoords(a);if(!l)return!0;let i=(0,V.nj)(e.state.doc,l.pos,r);if(null===i)return!0;let{tr:s}=e.state,o=e.state.doc.nodeAt(n);if(!o)return!0;let d=n,c=n+o.nodeSize,u=i;return i>d&&(u=i-o.nodeSize),s.delete(d,c),s.insert(u,o),e.dispatch(s),n=null,r=null,!0},dragover:(e,t)=>(null!==n&&t.preventDefault(),!1)}},view:i=>{var s;let o=document.createElement("div");o.style.position="relative",o.style.width="0",o.style.height="0",o.style.overflow="visible",o.style.paddingRight="4px";let d=document.createElement("div");d.className=t,d.draggable=!0,d.style.position="absolute",d.style.pointerEvents="auto",d.style.cursor="grab",d.style.display="none",d.style.zIndex="50",d.classList.add("text-tertiary"),d.innerHTML='<svg width="16" height="16" fill="none" viewBox="0 0 16 16" class="text-tertiary size-6 p-1 rounded-full hover:bg-fill-hover top-0"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="currentStroke" d="M6 8.668a.667.667 0 1 0 0-1.333.667.667 0 0 0 0 1.333ZM6 4.001a.667.667 0 1 0 0-1.333.667.667 0 0 0 0 1.333ZM6 13.335A.667.667 0 1 0 6 12a.667.667 0 0 0 0 1.334ZM10 8.668a.667.667 0 1 0 0-1.333.667.667 0 0 0 0 1.333ZM10 4.001a.667.667 0 1 0 0-1.333.667.667 0 0 0 0 1.333ZM10 13.335a.667.667 0 1 0 0-1.333.667.667 0 0 0 0 1.333Z" /></svg>',o.appendChild(d),null===(s=i.dom.parentElement)||void 0===s||s.insertBefore(o,i.dom);let c=null,u=null,p=(t,a)=>{let n=a;for(;n&&n!==t.dom;){try{let a=t.posAtDOM(n,0),r=t.state.doc.resolve(a);for(let a=r.depth;a>=1;a--){let n=r.node(a);if(e.includes(n.type.name)){let e=r.before(a),n=t.nodeDOM(e);if(n)return{pos:e,dom:n}}}}catch(e){}n=n.parentElement}return null},m=e=>{if(l)return;let t=e.target;if(d.contains(t))return;if(!t||!i.dom.contains(t)){d.style.display="none",c=null,u=null;return}let n=p(i,t);if(!n){d.style.display="none",c=null,u=null;return}let{pos:r,dom:s}=n,o=s.getBoundingClientRect(),m=i.dom.getBoundingClientRect(),h=o.top-m.top,f=o.left-m.left-a;d.style.top="".concat(h,"px"),d.style.left="".concat(f,"px"),d.style.display="flex",d.style.height="".concat(a,"px"),c=r,u=s};return d.addEventListener("mousedown",e=>{e.stopPropagation()}),d.addEventListener("dragstart",e=>{if(null===c||!e.dataTransfer)return;let t=i.state.doc.nodeAt(c);if(!t)return;l=!0,n=c,r=t.slice(0);let a=K.qv.create(i.state.doc,c);i.dispatch(i.state.tr.setSelection(a)),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("application/x-tiptap-drag","true"),u&&e.dataTransfer.setDragImage(u,0,0),d.style.cursor="grabbing"}),d.addEventListener("dragend",()=>{l=!1,d.style.cursor="grab",d.style.display="none",n=null,r=null}),document.addEventListener("mousemove",m),{update(){null!==c&&!l&&c>=i.state.doc.content.size&&(d.style.display="none",c=null,u=null)},destroy(){o.remove(),document.removeEventListener("mousemove",m)}}}})]}}),Z=k.NB.create({name:"divStyles",group:"block",content:"block+",draggable:!1,isolating:!0,addAttributes:()=>({style:{parseHTML:e=>{var t;return null===(t=e.style)||void 0===t?void 0:t.cssText}},class:{parseHTML:e=>e.getAttribute("class")}}),parseHTML:()=>[{tag:"div"},{tag:"main"},{tag:"section"},{tag:"article"},{tag:"aside"},{tag:"header"},{tag:"footer"},{tag:"nav"},{tag:"form"},{tag:"dialog"},{tag:"details"},{tag:"summary"},{tag:"figure"},{tag:"figcaption"},{tag:"picture"},{tag:"video"},{tag:"audio"},{tag:"iframe"},{tag:"embed"},{tag:"object"},{tag:"param"},{tag:"source"},{tag:"track"},{tag:"canvas"},{tag:"svg"},{tag:"math"},{tag:"pre"},{tag:"code"},{tag:"samp"},{tag:"kbd"},{tag:"var"},{tag:"cite"},{tag:"dfn"},{tag:"abbr"},{tag:"time"},{tag:"mark"},{tag:"ruby"},{tag:"rt"},{tag:"rp"},{tag:"bdi"},{tag:"bdo"},{tag:"iframe"},{tag:"embed"},{tag:"object"},{tag:"param"},{tag:"source"},{tag:"track"},{tag:"canvas"},{tag:"svg"},{tag:"math"},{tag:"pre"},{tag:"code"},{tag:"samp"},{tag:"kbd"},{tag:"var"},{tag:"cite"},{tag:"dfn"},{tag:"abbr"},{tag:"time"},{tag:"mark"},{tag:"ruby"},{tag:"rt"},{tag:"rp"},{tag:"bdi"},{tag:"bdo"}],renderHTML(e){let{HTMLAttributes:t}=e;return["div",t,0]}});var W=a(23412),Y=a(15751);let q=e=>{let{node:t}=e,a=t.attrs;return(0,n.jsx)(l.T5,{className:"my-4 flex w-full justify-start",children:(0,n.jsx)("div",{className:(0,Y.cn)("flex items-center justify-center gap-2 rounded-lg bg-fill"),style:{width:a.width,height:a.height},children:(0,n.jsx)(W.c,{className:"size-5 animate-spin"})})})},J=k.NB.create({name:"imageLoader",group:"block",atom:!0,draggable:!0,addAttributes:()=>({width:{default:50},height:{default:50},name:{default:null}}),parseHTML:()=>[{tag:'div[data-type="image-placeholder"]'}],renderHTML(e){let{HTMLAttributes:t}=e;return["div",(0,k.P1)(t,{"data-type":"image-placeholder"})]},addNodeView:()=>(0,l.fW)(q,{className:"image-loader"})}),X=k.NB.create({name:"indent",addGlobalAttributes:()=>[{types:["paragraph","heading"],attributes:{indent:{default:0,parseHTML:e=>parseInt(e.style.marginLeft,10)||0,renderHTML:e=>0===e.indent?{}:{style:"margin-left: ".concat(e.indent,"px;")}}}}],addCommands:()=>({indent:()=>e=>{let{state:t,dispatch:a}=e,{tr:n,selection:r}=t,{from:l,to:i}=r;return t.doc.nodesBetween(l,i,(e,t)=>{if("paragraph"===e.type.name||"heading"===e.type.name){let a=e.attrs.indent||0;n.setNodeMarkup(t,void 0,{...e.attrs,indent:a+24})}}),a&&a(n),!0},outdent:()=>e=>{let{state:t,dispatch:a}=e,{tr:n,selection:r}=t,{from:l,to:i}=r;return t.doc.nodesBetween(l,i,(e,t)=>{if("paragraph"===e.type.name||"heading"===e.type.name){let a=e.attrs.indent||0;n.setNodeMarkup(t,void 0,{...e.attrs,indent:Math.max(0,a-24)})}}),a&&a(n),!0}})}),Q=k.hj.create({name:"preserveAllStyles",priority:1e3,addGlobalAttributes:()=>[{types:["paragraph","textStyle","heading","blockquote","codeBlock","listItem","bulletList","orderedList","horizontalRule","image","resizableImage","link","table","tableRow","tableCell","tableHeader","hardBreak","taskItem","taskList","span"],attributes:{__hadOriginalStyle:{default:!1,parseHTML:e=>e.attributes.length>0,renderHTML:()=>({})},class:{default:null,parseHTML:e=>e.getAttribute("class"),renderHTML:e=>e.class?{class:e.class}:{}},style:{default:null,parseHTML:e=>e.getAttribute("style"),renderHTML:e=>e.style?{style:e.style}:{}},dataset:{default:null,parseHTML:e=>{let t={};return Array.from(e.attributes).forEach(e=>{e.name.startsWith("data-")&&(t[e.name]=e.value)}),Object.keys(t).length?t:null},renderHTML:e=>e.dataset?e.dataset:{}},originalAttributes:{default:null,parseHTML:e=>{let t={};return Array.from(e.attributes).forEach(e=>{"style"===e.name||"class"===e.name||e.name.startsWith("data-")||(t[e.name]=e.value)}),Object.keys(t).length?t:null},renderHTML:e=>e.originalAttributes?e.originalAttributes:{}}}}]}),$=k.NB.create({name:"spanStyles",group:"inline",inline:!0,atom:!0,priority:1e3,addAttributes:()=>({style:{default:null,parseHTML:e=>{var t;return(null===(t=e.style)||void 0===t?void 0:t.cssText)||null}},class:{default:null,parseHTML:e=>e.getAttribute("class")},text:{default:"",parseHTML:e=>e.textContent||""}}),parseHTML:()=>[{tag:"span[style]",priority:60}],renderHTML(e){let{node:t}=e,a={};return t.attrs.style&&(a.style=t.attrs.style),t.attrs.class&&(a.class=t.attrs.class),["span",a,t.attrs.text]}}),ee=[u.NM.configure({shouldShow:e=>{let{editor:t}=e;return t.state.selection.content().size>0}}),G,Q,Z,$,x.Z.configure({bulletList:!1,orderedList:!1,listItem:!1,trailingNode:!1,dropcursor:!1}),m.ZP.configure({inline:!1,allowBase64:!0,resize:{enabled:!0,directions:["top-left","top-right","bottom-left","bottom-right"],minWidth:50,minHeight:50,alwaysPreserveAspectRatio:!1}}),A.m$.configure({color:"#3b82f6",width:2}),A.Y1.configure({className:"docs-selection-highlight"}),c.ZP,h.ZP,T.Z,y.ZP,S.ZP,X,b.Z.configure({placeholder:e=>{let{editor:t,node:a}=e,n="taskList"===a.type.name||"orderedList"===a.type.name||"bulletList"===a.type.name||"table"===a.type.name||"tableRow"===a.type.name||"divStyles"===a.type.name&&a.content.size>2,r=t&&!t.isEmpty;return n||r?"":"Start writing..."}}),v.Z.configure({types:["heading","paragraph","listItem","taskItem"]}),_.Tb,U.configure({HTMLAttributes:{style:"border-collapse: collapse; width: 100%; table-layout: fixed; border: 1px solid #000;"}}),P.configure({HTMLAttributes:{style:"border: 1px solid #000; padding: 8px; min-height: 32px;"}}),z.configure({HTMLAttributes:{style:"border: 1px solid #000; padding: 8px; min-height: 32px;"}}),j.configure({HTMLAttributes:{style:"border: 1px solid #000;"}}),F.configure({table:{HTMLAttributes:{style:"border-collapse: collapse; width: 100%; table-layout: fixed; border: 1px solid #000;"},allowTableNodeSelection:!1,lastColumnResizable:!0,resizable:!0}}),B,w.configure({levels:[1,2,3],HTMLAttributes:{class:"docs-heading"}}),g.n,M.configure({listItem:{HTMLAttributes:{style:"margin-left: 12px;"}},taskItem:{HTMLAttributes:{style:"list-style: none; display: flex; align-items: center; gap: 8px;"}}}),O.configure({HTMLAttributes:{style:"margin-left: 12px;"}}),L.configure({HTMLAttributes:{style:"list-style-type: disc; margin-left: 12px;"}}),N.configure({HTMLAttributes:{style:"list-style-type: decimal; margin-left: 12px;"}}),C.configure({HTMLAttributes:{style:"list-style: none; display: flex; align-items: center; gap: 8px;"}}),I.configure({HTMLAttributes:{style:"list-style-type: none; padding-left: 0; margin-left: 12px;"}}),f.ZP.configure({openOnClick:!0,autolink:!0,defaultProtocol:"https",HTMLAttributes:{style:"color: #800080; text-decoration: underline; cursor: pointer;",rel:"noopener noreferrer",target:null}}),J,p.Z];var et=a(80950);let ea=(e,t,a)=>'\n  <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset="UTF-8">\n          <title>'.concat(e,"</title>\n          ").concat(a,"\n          <style>\n            ").concat("\n        @page {\n          margin: 0;\n          size: 210mm 297mm;\n        }\n\n        /* Cross-platform Font Mappings */\n        @font-face {\n          font-family: 'SimSun';\n          src: local('SimSun'), local('Songti SC'), local('STSong'), local('Noto Serif SC');\n        }\n        @font-face {\n          font-family: '宋体';\n          src: local('SimSun'), local('Songti SC'), local('STSong'), local('Noto Serif SC');\n        }\n        @font-face {\n          font-family: 'KaiTi';\n          src: local('KaiTi'), local('Kaiti SC'), local('STKaiti');\n        }\n        @font-face {\n          font-family: '楷体';\n          src: local('KaiTi'), local('Kaiti SC'), local('STKaiti');\n        }\n        @font-face {\n          font-family: 'Microsoft YaHei';\n          src: local('Microsoft YaHei'), local('PingFang SC'), local('Heiti SC'), local('Noto Sans SC');\n        }\n        @font-face {\n          font-family: '微软雅黑';\n          src: local('Microsoft YaHei'), local('PingFang SC'), local('Heiti SC'), local('Noto Sans SC');\n        }\n        @font-face {\n          font-family: 'SimHei';\n          src: local('SimHei'), local('Heiti SC'), local('PingFang SC'), local('Noto Sans SC');\n        }\n        @font-face {\n          font-family: '黑体';\n          src: local('SimHei'), local('Heiti SC'), local('PingFang SC'), local('Noto Sans SC');\n        }\n\n        html, body {\n          margin: 0;\n          padding: 0;\n          background: white;\n          width: 100%;\n          height: auto;\n          box-sizing: border-box;\n          font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji\", \"SimSun\", \"宋体\", \"Microsoft YaHei\", \"微软雅黑\", \"PingFang SC\", \"Hiragino Sans GB\", \"Heiti SC\";\n        }\n\n        *, *::before, *::after {\n          -webkit-print-color-adjust: exact !important;\n          print-color-adjust: exact !important;\n          color-adjust: exact !important;\n        }\n\n        .docs-tiptap {\n          width: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          padding: 0 !important;\n          border: none !important;\n          border-radius: 0 !important;\n          box-shadow: none !important;\n          background: transparent !important;\n        }\n\n        p, li, div {\n          break-inside: avoid;\n        }\n        \n        h1, h2, h3, h4, h5, h6 {\n          break-after: avoid; \n          break-inside: avoid;\n        }\n\n        table {\n          width: 100%;\n          border-collapse: collapse;\n          break-inside: auto;\n        }\n        \n        tr {\n          break-inside: avoid;\n          break-after: auto;\n        }\n\n        img {\n          max-width: 100%;\n          height: auto;\n          break-inside: avoid;\n        }\n        \n        .no-print {\n          display: none !important;\n        }\n      ",'\n          </style>\n        </head>\n        <body>\n          <div class="print-container">\n            ').concat(t.outerHTML,"\n          </div>\n        </body>\n      </html>"),en=async(e,t)=>{if(!e)return;let a=e.view.dom.closest(".docs-tiptap");if(!a){et.Am.error("Failed to find editor element");return}let{from:n,to:r}=e.state.selection,l=n!==r,i=null,s=()=>{if(i&&i.parentNode&&i.remove(),l)try{e.commands.setTextSelection({from:n,to:r})}catch(e){}};try{var o,d,c;l&&e.commands.setTextSelection(0),(i=document.createElement("iframe")).style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="1px",i.style.height="1px",i.style.opacity="0",i.style.pointerEvents="none",document.body.appendChild(i);let n=i.contentDocument||(null===(o=i.contentWindow)||void 0===o?void 0:o.document);if(!n)throw Error("Failed to create print frame");let r=Array.from(document.styleSheets),u="";r.forEach(e=>{try{if(e.href)u+='<link rel="stylesheet" href="'.concat(e.href,'" />');else if(e.cssRules){let t=Array.from(e.cssRules).map(e=>e.cssText).join("\n");u+="<style>".concat(t,"</style>")}}catch(e){}});let p=a.cloneNode(!0);n.open(),n.write(ea(t,p,u)),n.close();try{await (null===(c=i.contentDocument)||void 0===c?void 0:null===(d=c.fonts)||void 0===d?void 0:d.ready)}catch(e){}if(i.contentWindow){let e=i.contentWindow;e.focus(),e.addEventListener("afterprint",s,{once:!0}),e.print()}}catch(e){et.Am.error("Failed to export PDF"),s()}},er=async(e,t)=>{if(!t){et.Am.error("Failed to find editor element");return}let a=new Blob([t],{type:"text/html"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download="".concat(e,".html"),r.click(),URL.revokeObjectURL(n),et.Am.success("Document exported as HTML")},el=e=>{let t=K.yy.create({doc:e.state.doc,plugins:e.state.plugins});e.view.updateState(t)},ei=(e,t)=>{if(!d.includes(t.key))return!1;let{selection:a}=e.state,{$from:n}=a,r=-1;for(let e=n.depth;e>0;e--)if("divStyles"===n.node(e).type.name){r=e;break}return -1!==r&&(!!("ArrowUp"===t.key&&e.endOfTextblock("up")&&0===n.index(r)||"ArrowDown"===t.key&&e.endOfTextblock("down")&&n.index(r)===n.node(r).childCount-1)||"ArrowLeft"===t.key&&n.pos===n.start(r)+1||"ArrowRight"===t.key&&n.pos===n.end(r)-1)},es=e=>{var t,a;let{selection:n}=e.state,{from:r,to:l}=n,i=e.state.doc.textBetween(r,l," ");return r!==l&&i.trim().length>0?i.trim().split(/\s+/).filter(e=>""!==e).length:null!==(a=null===(t=e.storage.characterCount)||void 0===t?void 0:t.words())&&void 0!==a?a:0},eo=(0,i.createContext)(void 0),ed=e=>{let{children:t}=e,[a,d]=(0,i.useState)(0),[c,u]=(0,i.useState)(0),[p,m]=(0,i.useState)(null),[h,f]=(0,i.useState)(!1),g=(0,i.useRef)(null),[b,y]=(0,i.useState)(1),[v,_]=(0,i.useState)(!1),[S,T]=(0,i.useState)(!1),A=(0,l.jE)({extensions:ee,immediatelyRender:!1,editable:!0,content:s.VA,autofocus:!0,editorProps:{attributes:{class:"docs-tiptap light text-primary placeholder:text-disabled placeholder:text-heading-xl placeholder:font-bold",style:"border-radius: 1rem; overflow: hidden; outline: none; background-color: #fff; color: #171717;"},handleKeyDown:ei},onUpdate:e=>{let{editor:t}=e;if(t.isEmpty){let{selection:e}=t.state,{$head:a}=e;"paragraph"===a.parent.type.name&&requestAnimationFrame(()=>{t.commands.setContent(s.VA)})}}}),x=(0,i.useCallback)(e=>{if(!A)return;if(!e||""===e.trim()){g.current=null,m(null),A.setOptions({editorProps:{attributes:{style:o}}}),A.commands.setContent(""),el(A);return}let t=e.trim();if(t.startsWith("<!DOCTYPE")||t.startsWith("<html")&&t.includes("</html>"))try{let a=null,n=t.match(/<!DOCTYPE[^>]*>/i);n&&(a=n[0]);let r=new DOMParser().parseFromString(e,"text/html"),l=r.documentElement,i=Array.from(l.attributes).filter(e=>"style"!==e.name).map(e=>"".concat(e.name,'="').concat(e.value,'"')).join(" "),s=l.getAttribute("style")||"",o=r.head.innerHTML,d=r.body,c=Array.from(d.attributes).filter(e=>"style"!==e.name).map(e=>"".concat(e.name,'="').concat(e.value,'"')).join(" "),u=d.getAttribute("style")||"",p={doctype:a,htmlAttributes:i,headContent:o,bodyAttributes:c,htmlStyle:s,bodyStyle:u};g.current=p,m(p);let h=d.innerHTML;A.setOptions({editorProps:{attributes:{style:u}}}),A.commands.setContent(h),el(A)}catch(t){g.current=null,m(null),A.setOptions({editorProps:{attributes:{style:o}}}),A.commands.setContent(e),el(A)}else g.current=null,m(null),A.setOptions({editorProps:{attributes:{style:o}}}),A.commands.setContent(e),el(A);e===s.VA||v||_(!0)},[A,v]),w=(0,i.useCallback)(e=>{A&&A.setOptions({editable:e})},[A]),E=(0,i.useCallback)(()=>{if(!A)return"";let e=A.getHTML(),t=g.current;if(t){let a=t.doctype||"<!DOCTYPE html>",n="<html";t.htmlAttributes&&(n+=" ".concat(t.htmlAttributes)),t.htmlStyle&&(n+=' style="'.concat(t.htmlStyle,'"')),n+=">";let r=t.headContent||"",l="<body";return t.bodyAttributes&&(l+=" ".concat(t.bodyAttributes)),t.bodyStyle&&(l+=' style="'.concat(t.bodyStyle,'"')),l+=">","".concat(a,"\n").concat(n,"\n").concat("<head>","\n").concat(r,"\n").concat("</head>","\n").concat(l,"\n").concat(e,"\n").concat("</body>","\n").concat("</html>")}return e},[A]),O=(0,i.useCallback)(async e=>{let{format:t,docName:a}=e;A&&(f(!0),t===s.rT.PDF?await en(A,a):await er(a,E()),f(!1))},[A,E]),C=(0,i.useCallback)(()=>{if(!A)return{text:"",element_html:""};let{state:e}=A,{selection:t}=e,{from:a,to:n}=t,l=e.doc.textBetween(a,n),i="";if(a!==n){let t=e.doc.resolve(a),l=t.depth;for(;l>0;){let a=t.node(l);if(a.type.isBlock&&"doc"!==a.type.name){let t=document.createElement("div"),n=r.PW.fromSchema(e.schema).serializeNode(a);t.appendChild(n),i=t.innerHTML;break}l--}if(!i){let t=e.doc.slice(a,n),l=document.createElement("div"),s=r.PW.fromSchema(e.schema).serializeFragment(t.content);l.appendChild(s),i=l.innerHTML}}return{text:l,element_html:i}},[A]);(0,i.useEffect)(()=>{if(!A)return;let e=()=>{d(e=>e+1),u(es(A))};return A.on("transaction",e),()=>{A.off("transaction",e)}},[A]),(0,i.useEffect)(()=>{if(!p)return;let e=[];if(p.htmlStyle){let t=p.htmlStyle.split(";").filter(e=>e.trim().startsWith("--")).map(e=>e.trim()).filter(Boolean);if(t.length>0){let a=document.getElementById("docs-editor-css-vars");a&&a.remove();let n=document.createElement("style");n.id="docs-editor-css-vars";let r=t.map(e=>e.trim().endsWith(";")?e.trim():"".concat(e.trim(),";"));n.textContent="\n          :root {\n            ".concat(r.join("\n            "),"\n          }\n          .docs-tiptap {\n            ").concat(r.join("\n            "),"\n          }\n        "),document.head.appendChild(n),e.push(n)}}if(p.headContent){let t=document.createElement("div");t.innerHTML=p.headContent,Array.from(t.querySelectorAll("link")).forEach(t=>{let a=t.getAttribute("href");if(a&&(a.includes("fonts.googleapis.com")||a.includes("fonts.gstatic.com"))&&!document.querySelector('link[href="'.concat(a,'"]'))){let a=document.createElement("link");Array.from(t.attributes).forEach(e=>{a.setAttribute(e.name,e.value)}),a.setAttribute("data-docs-editor-font","true"),document.head.appendChild(a),e.push(a)}})}return()=>{e.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)})}},[p]),(0,i.useEffect)(()=>{if(!A)return;let e=e=>{if(!A.view.hasFocus())return;let t=e.metaKey||e.ctrlKey,a=e.key.toLowerCase();t&&s.SY.includes(a)&&e.stopPropagation()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[A]);let L=(0,i.useMemo)(()=>({editor:A,wordCount:c,setContent:x,editorStateVersion:a,setEditable:w,getContent:E,exportDoc:O,getCurrentSelectionInfo:C,setDocsWidth:y,docsWidth:b,isDownloading:h,shouldOpenEditor:v,setShouldOpenEditor:_,hasUnsavedChanges:S,setHasUnsavedChanges:T}),[A,c,x,a,w,E,O,C,b,h,v,_,S]);return(0,n.jsx)(eo.Provider,{value:L,children:t})},ec=()=>{let e=(0,i.useContext)(eo);if(!e)throw Error("useDocsEditorContext must be used within a DocsEditorProvider");return e}},10797:function(e,t,a){a.d(t,{MA:function(){return c},XY:function(){return u},ak:function(){return o},LZ:function(){return d}});var n=a(23829),r=a(16888),l=a(59480),i=a(51897);let s="".concat(i.x.NEXT_PUBLIC_APP_API_ENDPOINT,"/doc/completions"),o=async e=>{let{response:t,content:a,setContent:r,tools:l}=e;switch(t.type){case n.d.REASONING:a[n.d.REASONING]+=t.content;break;case n.d.TOKEN:a[n.d.TOKEN]+=t.content;break;case n.d.CITATION_IMAGE:{let e=JSON.parse(t.content.toString());a[n.d.TOKEN]+="![".concat(e.title,"](").concat(e.url,")");break}case n.d.CITATION_VIDEO:{let e=JSON.parse(t.content.toString());a[n.d.CITATION_VIDEO].push(e);break}case n.d.TOOL_CALL:t.tool in a[n.d.TOOL_CALL]?a[n.d.TOOL_CALL][t.tool].push(t.content.toString()):a[n.d.TOOL_CALL][t.tool]=[t.content.toString()];break;case n.d.TOOL_RESULT:{let e=a[n.d.TOOL_RESULT];switch(t.tool){case l.docsWebSearch:{let r=JSON.parse(t.content.toString());a[n.d.TOOL_RESULT]={web_results:[...e.web_results,...r.web_results],image_results:[],video_results:[],related_searches:[],structure:e.structure,plan:e.plan,docsScrapper:e.docsScrapper,docsRag:e.docsRag};break}case l.docsScrapper:Array.isArray(t.content)&&(a[n.d.TOOL_RESULT]={...e,docsScrapper:t.content});break;case l.structure:Array.isArray(t.content)&&(a[n.d.TOOL_RESULT]={...e,structure:t.content});break;case l.plan:Array.isArray(t.content)&&(a[n.d.TOOL_RESULT]={...e,plan:t.content});break;case l.docsRag:Array.isArray(t.content)&&(a[n.d.TOOL_RESULT]={...e,docsRag:t.content})}break}case n.d.DOC:r(t.content.toString());break;case n.d.EMAIL_BLOCK:a[n.d.EMAIL_BLOCK]+=t.content;break;case n.d.HAND_OFF:t.content===n.Z.OTHER&&t.finish_reason?a[n.d.TOKEN]+=t.finish_reason:a[n.d.HAND_OFF]=t.content;case n.d.CITATION:}};async function d(e){let{setContent:t,reader:a,currentMessage:r,setCurrentMessage:i,setCurrentContentType:s,setHasToolCallAfterToken:d,setCurrentToolName:c,controller:u,tools:p}=e,m={[n.d.REASONING]:"",[n.d.TOKEN]:"",[n.d.CITATION]:[],[n.d.CITATION_VIDEO]:[],[n.d.TOOL_CALL]:{},[n.d.TOOL_RESULT]:{web_results:[],image_results:[],video_results:[],related_searches:[],structure:[],plan:[],docsScrapper:[],docsRag:[]},[n.d.EMAIL_BLOCK]:"",[n.d.HAND_OFF]:""},h="",f=-1;for await(let e of(0,l.V)(a))h||(h=e.id),s(e.type),e.type===n.d.TOOL_CALL?(e.tool&&c(e.tool),m[n.d.TOKEN].length>0&&-1===f&&(f=m[n.d.TOKEN].length,d(!0))):e.type===n.d.TOKEN&&-1!==f&&(d(!1),c(null),f=-1),o({response:e,content:m,setContent:t,tools:p}),r&&!u.signal.aborted&&i({...r,id:h,content:{...m}});return{id:h,content:m,role:"assistant"}}let c=e=>{let{id:t,messages:a,htmlDocument:r,isChatTitleGeneneration:l,isChatMode:i,ephemeral:s=!1}=e,o=new FormData;return o.append("data",JSON.stringify({id:l?t:void 0,chat_id:t,messages:[...a.map(e=>{var t;if("assistant"===e.role)return{...e,content:e.content[n.d.TOKEN]};let a=e.content.map(e=>"file"===e.type?{type:"file",mimetype:e.mimetype,file_url:{url:e.file_url.url,meta_data:{name:e.name}}}:"image_url"===e.type?{type:"image_url",mimetype:e.mimetype,file_url:{url:e.file_url.url,meta_data:{name:e.name}}}:{type:"text",text:e.text}).filter(e=>e);return{id:e.id,role:"user",content:a,selection_info:null!==(t=e.selection_info)&&void 0!==t?t:void 0,ephemeral:s}})],html_document:r,isChatMode:i})),o};async function u(e){let{id:t,messages:a,systemMessage:n,controller:l,htmlDocument:i,isChatMode:o,ephemeral:d}=e,u=c({id:t,messages:a,systemMessage:n,htmlDocument:i,isChatMode:o,ephemeral:d}),p=await fetch(s,{method:"POST",headers:{Authorization:(0,r.Oj)()},body:u,signal:l.signal});if(200!==p.status)throw Error((await p.json()).error.toString());if(!p.body)throw Error("Response body does not exist");return p.body.getReader()}},92177:function(e,t,a){a.d(t,{C1:function(){return d},EK:function(){return u},gJ:function(){return o},yC:function(){return c}});var n=a(79417),r=a(65598),l=a(20273),i=a(16517),s=a(74012);let o=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,n.a)({queryKey:[s.E.GET_DOCS_REVISIONS,e],queryFn:()=>(0,i.bp)(e),select:e=>e.revisions,enabled:!!e&&t})},d=()=>(0,r.D)({mutationKey:[s.a.UPDATE_DOCS_REVISION],mutationFn:async e=>{let{revisionId:t,htmlSnapshot:a}=e;await (0,i.U0)(t,a)}}),c=()=>{let e=(0,l.NL)();return(0,r.D)({mutationFn:async e=>{let{id:t,name:a}=e;await (0,i.UN)(t,a)},onSuccess:()=>{e.invalidateQueries({queryKey:[s.E.UPDATE_DOCS_REVISION_TITLE]})}})},u=()=>{let e=(0,l.NL)();return(0,r.D)({mutationFn:async e=>{let{id:t,htmlSnapshot:a,summary:n}=e;await (0,i.L8)(t,a,n)},onSuccess:()=>{e.invalidateQueries({queryKey:[s.E.CREATE_BLANK_REVISION]})}})}},74012:function(e,t,a){a.d(t,{E:function(){return n},a:function(){return r}});let n={GET_DOCS_REVISIONS:"GetDocsRevisions",UPDATE_DOCS_REVISION:"UpdateDocsRevision",UPDATE_DOCS_REVISION_TITLE:"UpdateDocsRevisionTitle",CREATE_BLANK_REVISION:"CreateBlankRevision"},r={UPDATE_DOCS_REVISION:"UpdateDocsRevision"}},3769:function(e,t,a){a.d(t,{x:function(){return o}});var n=a(65598),r=a(88733),l=a(66612),i=a.n(l);let s=async e=>{let t=await i()(e,{useCORS:!0,allowTaint:!1,scale:2,backgroundColor:"#ffffff"});return new Promise((e,a)=>{t.toBlob(t=>{if(!t){a(Error("Canvas is tainted or empty"));return}e(new File([t],"thumbnail.png",{type:"image/png"}))},"image/png")})},o=()=>({updateChatThumbnailMutation:(0,n.D)({mutationFn:async e=>{let{chatId:t,thumbnail:a}=e,n=await s(a);return(0,r._x)({chatId:t,thumbnail:n})}})})},29306:function(e,t,a){a.d(t,{G:function(){return l}});var n=a(9786),r=a(51594);let l=()=>({isUtmPlanBasic:"Basic"===n.Z.get(r.y.UTM_PLAN)})},16517:function(e,t,a){a.d(t,{L8:function(){return m},L_:function(){return f},_U:function(){return p},bp:function(){return d},gf:function(){return h},U0:function(){return c},UN:function(){return u}});var n=a(51897),r=a(10797),l=a(54210),i=a(65714),s=a(57914);let o=new i.h({baseURL:"".concat(n.x.NEXT_PUBLIC_APP_API_ENDPOINT).concat(n.x.NEXT_PUBLIC_DOC_API_PATH),defaultHeadersGenerator:s.A}),d=async e=>{let{data:t}=await o.get("/".concat(e,"/revisions"),{},{throwOnError:!0});return t},c=async(e,t)=>{let a=new FormData;a.append("html_snapshot",t);let{data:n}=await o.put("/revisions/".concat(e),{body:a},{throwOnError:!0});return n},u=async(e,t)=>{let a=new FormData;a.append("title",t);let{data:n}=await o.patch("/revisions/".concat(e),{body:a,headers:{}},{throwOnError:!0});return n},p=async e=>{let{data:t}=await o.get("/".concat(e,"/messages"),{},{throwOnError:!0});return t},m=async(e,t,a)=>{let n=new FormData;n.append("chat_id",e),n.append("html_snapshot",t),n.append("summary",a);let{data:r}=await o.post("/revisions",{body:n},{throwOnError:!0});return r},h=async e=>{let{id:t,messages:a,htmlDocument:i}=e,s=(0,r.MA)({id:t,messages:a,htmlDocument:i,isChatTitleGeneneration:!0,isChatMode:!1});return await l.f.post("".concat(n.x.NEXT_PUBLIC_CHAT_API_PATH,"/titles"),{body:s},{throwOnError:!0})},f=async e=>{let{data:t}=await o.delete("/".concat(e,"/messages"),{},{throwOnError:!0});return t}},64925:function(e,t,a){a.d(t,{Ni:function(){return d},UT:function(){return o}});var n=a(10250),r=a(21956),l=a(79391);let i=e=>{let{flags:t}=e,a=t.reduce((e,t)=>(e[t.name]=t.status,e),{});return(0,l.Ue)(e=>({flags:a,setFlag:(t,a)=>{e(e=>({flags:{...e.flags,[t]:a}}))}}))},s=(0,r.createContext)(null),o=()=>{if(!s)throw Error("useUserBasedFlagsStoreContext must be used within a UserBasedFlagsStoreProvider");return(0,r.useContext)(s)},d=e=>{let{initialState:t,children:a}=e,[l]=(0,r.useState)(()=>i(t));return(0,n.jsx)(s.Provider,{value:l,children:a})}},23829:function(e,t,a){var n,r,l,i;a.d(t,{Z:function(){return r},d:function(){return n}}),(l=n||(n={})).REASONING="reasoning",l.TOKEN="token",l.CITATION="citation",l.CITATION_IMAGE="citation_image",l.CITATION_VIDEO="citation_video",l.TOOL_CALL="tool_call",l.TOOL_RESULT="tool_result",l.DOC="doc",l.EMAIL_BLOCK="email_block",l.HAND_OFF="hand_off",(i=r||(r={})).SHEETS="sheets",i.SLIDES="slides",i.IMAGE="image",i.OTHER="other"},62245:function(e,t,a){a.d(t,{B:function(){return d},D:function(){return c}});var n=a(13124),r=a.n(n),l=a(10797),i=a(23829);let s=e=>{var t,a;let{message:n,messageIndex:r,sortedMessages:s,parsedMessages:o,setContent:d,tools:c}=e;if(n.parent_id!==(null===(t=s[r+1])||void 0===t?void 0:t.id)&&(null===(a=s[r+1])||void 0===a?void 0:a.role)!=="assistant"){let e={[i.d.REASONING]:"",[i.d.TOKEN]:"",[i.d.CITATION]:[],[i.d.CITATION_VIDEO]:[],[i.d.TOOL_CALL]:{},[i.d.TOOL_RESULT]:{web_results:[],image_results:[],video_results:[],related_searches:[],structure:[],plan:[],docsRag:[],docsScrapper:[]},[i.d.EMAIL_BLOCK]:"",[i.d.HAND_OFF]:""},t=JSON.parse(n.content);t.streams.forEach(t=>{(0,l.ak)({response:{id:t.id,cid:t.cid,type:t.type,content:t.content,tool:t.tool,finish_reason:t.finish_reason},content:e,setContent:d,tools:c})}),"hand_off"in t&&"string"==typeof t.hand_off&&!e[i.d.HAND_OFF]&&(e[i.d.HAND_OFF]=t.hand_off),o.push({id:n.id,content:e,role:"assistant"})}},o=e=>{let{message:t,parsedMessages:a}=e;try{let e=JSON.parse(t.content),n=e.content.map(e=>{var a,n,r,l,i;switch(e.type){case"image_url":return{id:t.id,name:"Image",mimetype:"image/*",type:"image_url",file_url:{url:e.file_url.url,meta_data:{name:null!==(n=null===(a=e.file_url.meta_data)||void 0===a?void 0:a.name)&&void 0!==n?n:"Image"}}};case"file":return{id:t.id,name:"Document",mimetype:null!==(l=e.mimetype)&&void 0!==l?l:"application/unknown",type:"file",file_url:{url:e.file_url.url,meta_data:{name:null!==(i=null===(r=e.file_url.meta_data)||void 0===r?void 0:r.name)&&void 0!==i?i:"Document"}}};default:return{type:"text",text:e.text}}});a.push({id:t.id,role:"user",content:n,selection_info:e.selection_info})}catch(e){var n,r,l,i;a.push({id:t.id,role:"user",content:[{type:"text",text:t.content}],selection_info:{text:null!==(l=null===(n=t.selection_info)||void 0===n?void 0:n.text)&&void 0!==l?l:"",element_html:null!==(i=null===(r=t.selection_info)||void 0===r?void 0:r.element_html)&&void 0!==i?i:""}})}},d=(e,t,a)=>{let n=[...e].sort((e,t)=>r()(e.created_at).valueOf()-r()(t.created_at).valueOf()),l=[];return n.forEach((e,r)=>{"assistant"===e.role?s({message:e,messageIndex:r,parsedMessages:l,sortedMessages:n,setContent:t,tools:a}):o({message:e,parsedMessages:l})}),l},c=e=>{let{chatId:t,chatHistory:a}=e,n=a.find(e=>e.chat_id===t);if(n)return{time:"",chat:n}}}}]);