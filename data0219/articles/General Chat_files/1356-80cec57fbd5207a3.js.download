"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1356],{64112:function(e,t,a){a.d(t,{C:function(){return o},p:function(){return l}});var r=a(10250),n=a(58551),s=a(51697),i=a(67226);let o=e=>{let{children:t}=e,a=(0,s.cI)({resolver:(0,n.F)(i.Hg),defaultValues:{[i.mk.PROMPT]:"",[i.mk.FILES]:[]},mode:"onChange"});return(0,r.jsx)(s.RV,{...a,children:t})},l=()=>{let e=(0,s.Gc)();if(!e)throw Error("useImageGenerationFormContext must be used within ImageGenerationFormProvider");return e}},331:function(e,t,a){a.d(t,{o:function(){return eE},H:function(){return eI}});var r=a(10250),n=a(57331),s=a(88729),i=a(21956),o=a(61206),l=a(21761),u=a(23120),c=a(91210),d=a(56543),m=a(4206),_=a(35284),p=a(51846),E=a(63856),I=a(28886),g=a(61277),A=a(17393),f=a(21222),T=a(43192),R=a(1820),S=a(3874),h=a(85119),v=a(51897),N=a(83724),M=a(32360),O=a(38126),G=a(38055),y=a(20273),w=a(80950),C=a(91074),P=a(55720);let b=e=>{let t=new FormData;return t.append("chat_id",e.chat_id),t.append("prompt",e.prompt),t.append("intent",e.intent),t},x="/analyze",D=async(e,t)=>{let a=new FormData;a.append("data",JSON.stringify(e)),t&&a.append("metadata",JSON.stringify(t));let{data:r}=await P.p.post("".concat(x,"/intent"),{body:a},{throwOnError:!0});return r},L=async e=>{let t=b(e),{data:a}=await P.p.post("".concat(x,"/respond"),{body:t},{throwOnError:!0});return a},k=e=>{let t=new FormData;return Object.entries(e).forEach(e=>{let[a,r]=e;null!=r&&(Array.isArray(r)?r.forEach(e=>{t.append(a,e.toString())}):"object"==typeof r?t.append(a,JSON.stringify(r)):t.append(a,r.toString()))}),t},F=e=>{let t=new FormData;return t.append("image_url",e.image),t.append("chat_id",e.chatId),t.append("message_id",e.messageId),t.append("base_id",e.baseId),t.append("style_id","6"),t},U=e=>{let t=new FormData;return t.append("image_url",e.image),t.append("chat_id",e.chatId),t.append("message_id",e.messageId),t.append("base_id",e.baseId),t.append("style_id","40001"),t},j="/image";P.p.interceptors.response.use(e=>{let{data:t,response:a}=e;return a.url.includes("".concat(j,"/generate"))&&a.headers.get("x-enhanced-prompt")&&sessionStorage.setItem(m.M.PROMPT_ENHANCED_STATUS,"true"),{data:t,response:a}});let H=async(e,t)=>{let a=k(e),{data:r}=await P.p.post("".concat(j,"/generate"),{body:a,signal:t},{throwOnError:!0});return r},V=async(e,t)=>{let a=k(e),{data:r}=await P.p.post("".concat(j,"/generate/edits"),{body:a,signal:t},{throwOnError:!0});return r},W=async e=>{let t=F(e),{data:a}=await P.p.post("".concat(j,"/background/remove"),{body:t},{throwOnError:!0});return a},B=async e=>{let t=U(e),{data:a}=await P.p.post("".concat(j,"/enhance/upscale"),{body:t},{throwOnError:!0});return a};var Y=a(9540),Z=a(20225),q=a(62819),J=a(28860),z=a(59414),K=a(86213);let $={[J.Ov.CREATE]:"Images Generated",[J.Ov.EDIT]:"Image Edited",[J.Ov.MULTI_IMAGE_EDIT]:"Images Edited"},Q=e=>{let{id:t}=e,[a,r]=(0,i.useState)([]),[n,s]=(0,i.useState)({}),[o,l]=(0,i.useState)(),u=(0,y.NL)(),{data:c}=(0,N.VW)({id:t,type:"chat"}),d=(0,Z.Td)()(e=>e.globalConfig.imageGen.defaults),_=(0,q.m)()(e=>e.subscription),{openProModal:p}=(0,Y.I)(e=>({openProModal:()=>e.openDialog(E.W.PRO_MODAL)})),I=(0,i.useRef)(!1),g=(0,i.useRef)(null),[A,f]=(0,i.useState)(null),[T,R]=(0,i.useState)(!1),{handleServiceError:S}=(0,z.m)(),h=(0,i.useCallback)(async function(e,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2",s=arguments.length>3?arguments[3]:void 0;try{var i,o;R(!0);let c=await D(e,s);c&&sessionStorage.setItem(m.M.INTEN_CLASSIFICATION_STATUS,"true");let E={id:c.message_id,role:"assistant",content:c.agent_response,intent:c.intent};r(e=>[...e,E]),sessionStorage.setItem(m.M.IMAGE_GENERATION_INTENT_MODEL,c.model_to_use),sessionStorage.setItem(m.M.IMAGE_GENERATION_INTENT_PROMPT,c.prompt_for_enhancer);let A={prompt:c.prompt_for_enhancer,style_id:c.model_to_use,message_id:c.message_id,chat_id:t,signal:null===(i=g.current)||void 0===i?void 0:i.signal,count:n,aspect_ratio:c.aspect_ratio,enhancer_id:c.plugin_to_use};switch(c.intent){case J.Ov.CLARIFY:R(!1);break;case J.Ov.EDIT:case J.Ov.MULTI_IMAGE_EDIT:{let e;if(!_||!_.isActive)return p(),R(!1),null;a&&(e=d.defaultEditModelStyleId);let t={...A,style_id:null!==(o=null==e?void 0:e.toString())&&void 0!==o?o:A.style_id,count:"1",image_url:[]};await Promise.all(c.execution_groups.map(e=>V({...t,image_url:e.map(e=>e.replace(/\/variation\/(.+?)\/384$/,"/processed/$1"))}))),sessionStorage.setItem(m.M.FAL_API_GENERATION_STATUS,"true");break}case J.Ov.CREATE:await H(A),sessionStorage.setItem(m.M.FAL_API_GENERATION_STATUS,"true");break;default:w.Am.error("Unknown intent type")}return u.invalidateQueries({queryKey:[K.D.GET_CREDITS]}),l(c),I.current=!0,{intent_type:c.intent}}catch(e){return sessionStorage.setItem(m.M.IMAGE_GENERATION_ERROR,e instanceof Error?e.message:"Unknown error"),S(e),R(!1),null}},[t,u,S,p,_,d]),v=(0,i.useCallback)(async e=>{R(!0);try{let a={image:e.url.generation[0],chatId:t,messageId:e.message_id,baseId:e.id},r=await W(a);return await u.invalidateQueries({queryKey:[K.D.GET_CREDITS]}),r[0].id}catch(e){return sessionStorage.setItem(m.M.IMAGE_GENERATION_ERROR,e instanceof Error?e.message:"Unknown error"),S(e),R(!1),null}},[t,u,S]),M=(0,i.useCallback)(async e=>{R(!0);try{let a={image:e.url.variation.find(e=>e.endsWith("/640")),chatId:t,messageId:e.message_id,baseId:e.id},r=await B(a);return await u.invalidateQueries({queryKey:[K.D.GET_CREDITS]}),r[0].id}catch(e){return sessionStorage.setItem(m.M.IMAGE_GENERATION_ERROR,e instanceof Error?e.message:"Unknown error"),S(e),R(!1),null}},[t,u,S]),O=(0,i.useCallback)((e,t)=>void 0===e||e>=2*t?"2":"1",[]);return(0,i.useEffect)(()=>{var e;if(!o||!c||!I.current)return;let a=null!==(e=c[o.message_id])&&void 0!==e?e:[];if(!a.length)return;let n=a.every(e=>e.message===J.LZ.FINISHED);(async()=>{if(n){let e=await L({chat_id:t,intent:o.intent,prompt:o.prompt_for_enhancer});o.intent!==J.Ov.CLARIFY&&w.Am.success($[o.intent],{crossable:!0}),r(t=>[...t,{id:e.message_id,role:C.y.ASSISTANT,content:e.agent_response,intent:o.intent}]),I.current=!1,R(!1)}})()},[o,t,c,a]),{loading:T,error:A,currentIntent:o,resetImageGenChat:()=>{f(null),r([]),R(!1),g.current&&g.current.abort()},messages:a,setMessages:r,generateSystemResponse:h,messagesMeta:n,setMessagesMeta:s,removeAssetBackground:v,upscaleAsset:M,setLoading:R,getImageGenCount:O}};var X=a(29354),ee=a(11873),et=a(35609),ea=a(16522),er=a(12178),en=a(9842),es=a(20704),ei=a(16246),eo=a(36203),el=a(2350),eu=a(58129),ec=a(9137),ed=a(13124),em=a.n(ed);let e_=(e,t)=>{let a=[...e].sort((e,t)=>em()(e.created_at).valueOf()-em()(t.created_at).valueOf()),r=[];return a.forEach(e=>{"user"===e.role?(r.push({id:e.id,content:e.content,role:"user",input_images:e.attachments}),e.metadata&&Object.entries(e.metadata).forEach(e=>{let[a,r]=e;t[a]={image:r.image}})):r.push({id:e.id,content:e.content,role:"assistant",intent:e.attachments.length>0?J.Ov.CREATE:J.Ov.CLARIFY})}),r},ep=(0,i.createContext)(void 0),eE=e=>{var t;let{children:a}=e,y=(0,n.useRouter)(),[w,C]=(0,s.v1)("id"),[P,b]=(0,i.useState)(!1),x=(0,i.useRef)(null),{isFullViewOpen:D,closeFullView:L}=(0,Y.I)(e=>({isFullViewOpen:e.isDialogOpen(E.W.FULL_VIEW_IMAGE_DIALOG),closeFullView:()=>e.closeDialog(E.W.FULL_VIEW_IMAGE_DIALOG)})),k=(0,i.useRef)(null),{isUtmModelFlow:F,fullUtmModel:U}=(0,et.o)(),{aggregator:j}=(0,er.O)(),{userAccountStatus:H,userPlanPeriod:V,email:W,userId:B,slug:z,userPlan:K,source:$}=(0,ee.T)(),ed=(0,q.m)()(e=>e.user),{currentImageGenMessageId:em,currentImageGenModel:eE,autoModel:eI,currentAspectRatio:eg,setCurrentImageGenMessageId:eA,getModelNameByStyleIdForAnalytics:ef}=(0,ec.b)(),{getPromptsLeft:eT}=(0,X.$)(),{data:eR}=(0,ea.X)(),eS=(0,i.useMemo)(()=>null==eR?void 0:eR.tokens.media,[eR]),eh=(0,Z.Td)()(e=>e.imageGenModels),ev=(0,i.useMemo)(()=>2*Math.min(...eh.map(e=>e.creditCount)),[eh]),eN=(0,Y.I)(e=>()=>e.openDialog(E.W.IMAGE_GEN_LIMIT_MODAL)),eM=(0,n.useParams)(),eO=(0,i.useMemo)(()=>{var e,t;return null!==(t=null==eM?void 0:null===(e=eM.id)||void 0===e?void 0:e.toString())&&void 0!==t?t:(0,ei.O)()},[eM.id]),{data:eG}=(0,N.VW)({id:eO,type:"chat"}),ey=(0,N.Wr)(),{messages:ew,messagesMeta:eC,setMessages:eP,setMessagesMeta:eb,loading:ex,setLoading:eD,resetImageGenChat:eL,generateSystemResponse:ek,removeAssetBackground:eF,upscaleAsset:eU,currentIntent:ej,getImageGenCount:eH}=Q({id:eO}),{deviceType:eV}=(0,h.V)(),{isHistoryActive:eW}=(0,Z.Td)()(e=>({isHistoryActive:e.isHistoryActive})),{chatHistory:eB,syncUnifiedChatHistory:eY}=(0,S.o)(),{setCarryForward:eZ}=(0,O.H)(),eq=(0,M.N)(),eJ=(0,i.useMemo)(()=>(0,eo.H)({chatId:eO,chatHistory:eB}),[eO,eB]);(0,G.B)({feature:I.VS.IMAGE_GENERATION,title:null!==(t=null==eJ?void 0:eJ.title)&&void 0!==t?t:f.vx.title,description:f.vx.description});let ez=(0,i.useCallback)(e=>{x.current=e},[]),eK=(0,i.useCallback)(e=>{var t,a;let{userModelSelection:r,aspectRatio:n,uploadedImagesCount:s,isUpscale:i,isRemoveBg:l,messageId:u=em,userPromptText:_,intentType:E=""}=e,I=sessionStorage.getItem(m.M.IMAGE_GENERATION_PRESET_USED);sessionStorage.removeItem(m.M.IMAGE_GENERATION_PRESET_USED);let g=sessionStorage.getItem(m.M.IMAGE_GENERATION_INSPIRATION_USED);sessionStorage.removeItem(m.M.IMAGE_GENERATION_INSPIRATION_USED);let A=ef(null!==(t=sessionStorage.getItem(m.M.IMAGE_GENERATION_INTENT_MODEL))&&void 0!==t?t:""),f=r===(null==eI?void 0:eI.name)?"".concat(r,"_").concat(A):A,T=(0,es.y)(f);sessionStorage.removeItem(m.M.IMAGE_GENERATION_INTENT_MODEL);let R=sessionStorage.getItem(m.M.IMAGE_GENERATION_INTENT_PROMPT);sessionStorage.removeItem(m.M.IMAGE_GENERATION_INTENT_PROMPT);let S="true"===sessionStorage.getItem(m.M.INTEN_CLASSIFICATION_STATUS);sessionStorage.removeItem(m.M.INTEN_CLASSIFICATION_STATUS);let h="true"===sessionStorage.getItem(m.M.FAL_API_GENERATION_STATUS);sessionStorage.removeItem(m.M.FAL_API_GENERATION_STATUS);let v="true"===sessionStorage.getItem(m.M.PROMPT_ENHANCED_STATUS);sessionStorage.removeItem(m.M.PROMPT_ENHANCED_STATUS);let N=sessionStorage.getItem(m.M.IMAGE_GENERATION_ERROR);sessionStorage.removeItem(m.M.IMAGE_GENERATION_ERROR),j.log(o.H.image_generation_v2.withProperties({user_prompt_text:null!=_?_:void 0,enhanced_prompt_text:null!=R?R:void 0,model:null!==(a=(0,es.y)(A))&&void 0!==a?a:void 0,user_model_selection:T,aspect_ratio:n,processing_status:N?d.J.FAILURE:d.J.SUCCESS,processing_error:null!=N?N:void 0,intent_classification_status:S,fal_api_generation:h,prompt_enhanced:v,ref_images_uploaded_count:s,upload_used:!!s,inspiration_used:!!g,inspiration_category:null!=g?g:void 0,fullview_remove_bg:l,fullview_upscale:i,chat_id:eO,message_id:u,email:W,user_id:B,user_account_status:H,user_plan_period:V,preset_used:!!I,preset_category:null!=I?I:void 0,page_name:c.q.IMAGE_GENERATION,source:$,slug:z,user_plan:K,tokens_remaining:eT(p.D.IMAGES),device:eV,intent_type:E,...(0,eu.U)()}))},[em,ef,j,null==eI?void 0:eI.name,eO,W,B,H,V,$,z,K,eT,eV]),e$=(0,i.useCallback)(()=>{let e=2,t=[];return Object.values(null!=eG?eG:{}).forEach(a=>{a.forEach(a=>{0!==e&&a.message===J.LZ.FINISHED&&(e-=1,t.push(a.url.variation[4]))})}),t},[eG]),eQ=(0,i.useCallback)(()=>ew.length<g.av?ew:ew.slice(-g.av),[ew]),eX=(0,i.useCallback)(async e=>{let{prompt:t,files:a=[],model:r,aspectRatio:n}=e,s=null!=r?r:eE,i=null!=n?n:eg;if(b(!1),!ed){sessionStorage.setItem(m.M.AUTH_TRIGGER,u.y.IMAGE_GENERATION);let e=new URL(T.H7.IMAGE,window.location.origin);eZ({prompt:t,files:a,feature:I.VS.IMAGE_GENERATION}),new URLSearchParams(window.location.search).forEach((t,a)=>{e.searchParams.set(a,t)}),e.searchParams.set(g.Ro.MODEL,"".concat(s.styleId)),e.searchParams.set(R.t.SHOULD_CARRY_FORWARD,"true"),e.searchParams.set(g.Ro.ASPECT_RATIO,"".concat(eg.value)),y.push((0,el.YF)(T.H7.AUTH,{[R.t.REDIRECT]:e.href}));return}let o=(0,ei.O)(),l=localStorage.getItem(A.d.IMAGE_GEN_EDIT_IMAGE_IN_CHAT),c="";(w||l)&&(c=w?"".concat(v.x.NEXT_PUBLIC_ASSET_CDN,"/variation/").concat(w,"/384"):l),c&&(eb(e=>({...e,[o]:{image:c}})),localStorage.removeItem(A.d.IMAGE_GEN_EDIT_IMAGE_IN_CHAT),D&&(C(null),L()));let d={id:o,role:"user",content:t,input_images:a.map(e=>e.file_url.url)},_=[...eQ(),d],p=c?[c]:e$();eP(e=>[...e,d]);let E={chat_id:eO,messages:_,last_generated_images:p,aspect_ratio:i.value,model:s.styleId.toString()};eA(o);let f=c?{[o]:{image:c}}:void 0,S=eH(eS,s.toBeDeductedCredits),h=await ek(E,s.default,S,f);eq(I.VS.IMAGE_GENERATION),0===ew.length&&eW&&(await ey.mutateAsync({id:eO,messages:_,last_generated_images:p,model:s.styleId.toString(),aspect_ratio:i.value}),eY()),eM.id||y.push("".concat(T.H7.IMAGE,"/").concat(eO,"?").concat(F?"".concat(R.t.UTM_MODEL,"=").concat(U):"")),eK({userPromptText:t,aspectRatio:eg.value,userModelSelection:s.name,uploadedImagesCount:a.length,isUpscale:!1,isRemoveBg:!1,messageId:o,intentType:(null==h?void 0:h.intent_type)||""})},[eE,ed,w,eQ,e$,eP,eO,eg,eY,eA,ek,ew.length,eW,eM.id,eK,eZ,y,eb,D,C,L,ey,F,U,eq,eS,eH]),e0=(0,i.useCallback)(async e=>{var t,a;let r=ew.find(t=>t.id===e&&"user"===t.role);if(!r||"user"!==r.role)return;let n=null!==(a=null===(t=r.input_images)||void 0===t?void 0:t.map((e,t)=>({id:(0,ei.O)(),name:"image-".concat(t),mimetype:"image/jpeg",type:"image_url",file_url:{url:e,meta_data:{name:"image-".concat(t)}}})))&&void 0!==a?a:[];await eX({prompt:r.content,files:n})},[ew,eX]),e1=(0,i.useCallback)(async e=>{C(await eF(e)),eK({aspectRatio:eg.value,userModelSelection:eE.name,uploadedImagesCount:0,isUpscale:!1,isRemoveBg:!0})},[eF,C,eK,eE.name,eg.value]),e2=(0,i.useCallback)(async e=>{C(await eU(e)),eK({aspectRatio:eg.value,userModelSelection:eE.name,uploadedImagesCount:0,isUpscale:!0,isRemoveBg:!1})},[eU,C,eK,eE.name,eg.value]),e5=(0,i.useCallback)(()=>eL(),[eL]);(0,i.useEffect)(()=>{e5()},[eO]),(0,i.useEffect)(()=>{if(!eO)return;let e=async()=>{if(eJ){let e=await (0,en.Io)(eO);e&&(eP(e_(e,eC)),b(!0))}};eJ&&e()},[eO,eJ,eB]),(0,i.useEffect)(()=>{!ex&&eS&&eS<ev&&!P&&(sessionStorage.setItem(m.M.POPUP_TRIGGER,_.o.IMAGE_GENERATION_LIMIT),sessionStorage.setItem(m.H.TRIGGER,_.o.IMAGE_GENERATION_LIMIT),sessionStorage.setItem(m.M.ATC_CTA_SOURCE,l.I.INSUFFICIENT_CREDITS),eN())},[eS,ev,ex,P]);let e3=(0,i.useMemo)(()=>({formRef:k,isChatHistory:P,currentImageGenMessageId:em,messages:ew,setMessages:eP,messagesMeta:eC,setMessagesMeta:eb,chatId:eO,loading:ex,currentIntent:ej,sendImageBatchMessage:eX,regenerateMessage:e0,removeBackground:e1,upscaleAsset:e2,setLoading:eD,scrollContainerRef:x,registerScrollContainer:ez}),[k,P,ew,eC,eP,eb,em,eO,ex,ej,eX,e0,e1,e2,eD,x,ez]);return(0,r.jsx)(ep.Provider,{value:e3,children:a})},eI=()=>{let e=(0,i.useContext)(ep);if(void 0===e)throw Error("useImageGenContext must be used within a ImageGenProvider");return e}},83724:function(e,t,a){a.d(t,{VW:function(){return m},Wr:function(){return _}});var r,n=a(79417),s=a(65598),i=a(57331),o=a(28886),l=a(9842),u=a(20225),c=a(62819),d=a(2350);(r||(r={})).GET_IMAGE_GEN_HISTORY="get-image-gen-history";let m=e=>{let{id:t,type:a="chat"}=e,r=(0,c.m)()(e=>e.user),s=(0,i.usePathname)(),u=(0,d.JE)(s);return(0,n.a)({queryKey:[t,a],queryFn:()=>(0,l.HB)({id:t,type:a}),enabled:!!r&&!!t&&u===o.VS.IMAGE_GENERATION,staleTime:1/0})},_=()=>{let e=(0,u.Td)()(e=>e.isHistoryActive);return(0,s.D)({mutationFn:async t=>e?(0,l.ek)(t):Promise.reject(Error("History is not active"))})}},59414:function(e,t,a){a.d(t,{m:function(){return i}});var r=a(80950),n=a(41432),s=a(78435);let i=()=>{let e=e=>{switch(e){case 206:r.Am.error(n.Y[206]);break;case 451:r.Am.error(n.Y[451]);break;case 402:r.Am.error(n.Y[402]);break;case 400:r.Am.error(n.Y[400]);break;default:r.Am.error("An unexpected error occurred. Please try again later.")}};return{handleServiceError:t=>{let a=s.W.safeParse(t);if(a.success){e(a.data.code);return}"object"==typeof t&&t&&"statusCode"in t&&"number"==typeof t.statusCode?e(t.statusCode):r.Am.error("An unexpected error occurred. Please try again later.")}}}},1403:function(e,t,a){a.d(t,{Z:function(){return s}});var r=a(10250),n=a(15751);let s=e=>{let t,a,{aspectRatio:s="1:1",baseSize:i=18,stroke:o=1.5,padding:l=1,className:u}=e,[c=1,d=1]=s.split(":").map(Number),m=i-o,_=o/2+l;return c>d?(t=m,a=d/c*m):(a=m,t=c/d*m),(0,r.jsx)("div",{className:(0,n.cn)("flex shrink-0 grow-0 items-center justify-center",u),style:{width:"".concat(i,"px"),height:"".concat(i,"px"),padding:"".concat(_,"px")},children:(0,r.jsx)("div",{style:{width:"".concat(t-_,"px"),boxShadow:"0 0 0 ".concat(o,"px currentColor"),height:"".concat(a-_,"px"),borderRadius:"".concat(_,"px")}})})}},21356:function(e,t,a){a.d(t,{_:function(){return Z}});var r=a(10250),n=a(72005),s=a(61277),i=a(54679),o=a(51056),l=a(23074),u=a(1403),c=a(33472),d=a(21956),m=a(9137),_=a(28951),p=a(20225);let E=()=>{let[e,t]=(0,d.useState)(!1),a=(0,_.Ws)(),r=(0,p.Td)()(e=>e.imageGenAspectRatios),{aspectRatiosList:n,currentAspectRatio:s,setCurrentAspectRatio:i}=(0,m.b)();return{aspectRatios:n,currentAspectRatio:s,setCurrentAspectRatio:i,handleDropdownValueChange:e=>{let t=r.find(t=>t.value===e);t&&i(t)},isLaptop:a,isAspectRatioSelectionDropdownOpen:e,setIsAspectRatioSelectionDropdownOpen:t}},I=e=>{let{aspectRatioRef:t}=e,{aspectRatios:a,currentAspectRatio:n,handleDropdownValueChange:s,isLaptop:d,isAspectRatioSelectionDropdownOpen:m,setIsAspectRatioSelectionDropdownOpen:_}=E();return(0,r.jsxs)(o.h_,{open:m,onOpenChange:_,children:[(0,r.jsx)(o.$F,{asChild:!0,className:"bg-fill-secondary ring-0",children:(0,r.jsxs)(i.Button,{variant:"secondary",size:"xs",shape:"pill",className:"w-fit rounded-full",children:[(0,r.jsx)(u.Z,{stroke:1.5,aspectRatio:n.value}),(0,r.jsx)("span",{children:n.value})]})}),(0,r.jsx)(o.AW,{align:"start",className:"flex max-h-[240px] w-[240px] flex-col items-center gap-1 overflow-y-auto rounded-2xl p-2",onCloseAutoFocus:e=>e.preventDefault(),children:(0,r.jsx)(l.x,{ref:t,className:"flex size-full flex-col gap-1",scrollHideDelay:0,type:d?"hover":"always",children:(0,r.jsxs)(o.Qk,{className:"flex w-full flex-col gap-0.5",children:[(0,r.jsx)("p",{className:"p-2 text-label-sm font-medium text-tertiary",children:"Aspect Ratio"}),a.map(e=>(0,r.jsxs)(o.bO.Root,{checked:e.value===n.value,onClick:t=>{t.stopPropagation(),s(e.value)},className:"flex w-full cursor-pointer justify-start gap-2 rounded-xl p-2",disabled:e.isDisabled,children:[(0,r.jsx)(u.Z,{stroke:1,aspectRatio:e.value}),(0,r.jsxs)("p",{className:"text-label-md text-primary",children:[e.label," (",e.value,")"]}),(0,r.jsx)(o.bO.End,{children:(0,r.jsx)(c.n,{className:"size-[18px] shrink-0"})})]},e.value))]})})})]})};var g=a(57331),A=a(51697),f=a(5),T=a(80950),R=a(21761),S=a(4206),h=a(35284),v=a(51846),N=a(63856),M=a(28886),O=a(17393),G=a(43192),y=a(1820),w=a(331),C=a(64112),P=a(38126),b=a(52671),x=a(28337),D=a(23086),L=a(29354),k=a(79157),F=a(67226),U=a(9540),j=a(62819),H=a(3089),V=a(25510),W=a(12072),B=a(2350);let Y=e=>{let{isInspirations:t}=e,{checkProAccessRequirement:a}=(0,D.D)(),{imageGenModels:r,imageGenAspectRatios:n}=(0,p.Td)()(e=>({imageGenModels:e.imageGenModels,imageGenAspectRatios:e.imageGenAspectRatios})),i=(0,f.O_)(),o=(0,g.useRouter)(),l=(0,g.usePathname)(),u=(0,g.useSearchParams)(),c=u.get(s.Ro.MODEL),_=u.get(s.Ro.ASPECT_RATIO),E=(0,U.I)(e=>()=>e.openDialog(N.W.IMAGE_GEN_LIMIT_MODAL)),{subscription:I,user:Y}=(0,j.m)()(e=>({subscription:e.subscription,user:e.user})),{activePlanName:Z}=(0,W.L1)(I),q=(0,p.Td)()(e=>e.imageGenPresets),{hasReachedLimit:J,hasEnoughMediaTokens:z}=(0,L.$)(),{sendImageBatchMessage:K,loading:$,chatId:Q,formRef:X}=(0,w.H)(),{setCurrentImageGenModel:ee,setCurrentAspectRatio:et,currentAspectRatio:ea}=(0,m.b)(),{readCarryForward:er,clearCarryForward:en,setCarryForward:es}=(0,P.H)(),{handleRedirect:ei}=(0,k.J)(),eo=(0,C.p)(),el=(0,d.useMemo)(()=>(0,B.aw)(l),[l]),eu=(0,A.qo)({control:eo.control,name:F.mk.PROMPT,defaultValue:""}),ec=(0,A.qo)({name:F.mk.FILES,control:eo.control,defaultValue:[]}),ed=(0,d.useCallback)(e=>{let t=e.map(e=>(0,V.w2)(e.type)?{id:e.id,name:e.name,mimetype:e.type,type:"image_url",file_url:{url:e.url,meta_data:{name:e.name}}}:{id:e.id,name:e.name,mimetype:e.type,type:"file",file_url:{url:e.url,meta_data:{name:e.name}}});eo.setValue(F.mk.FILES,t)},[eo]),em=(0,d.useMemo)(()=>!a({isPro:!0})&&!el,[a,el]),{openFilePicker:e_,removeFile:ep,onFilePaste:eE,uploadingFiles:eI,removeAllFiles:eg,setFiles:eA}=(0,b.F)({id:Q,shouldAllowFileUpload:em,onFilesUpdated:ed,dropzoneEnabled:!0,acceptedMimeTypes:x.E0,acceptedFileTypes:x.jp,maxFilesAllowed:x.xP}),ef=()=>{sessionStorage.setItem(S.M.POPUP_TRIGGER,h.o.IMAGE_GENERATION_LIMIT),sessionStorage.setItem(S.H.TRIGGER,h.o.IMAGE_GENERATION_LIMIT),sessionStorage.setItem(S.M.ATC_CTA_SOURCE,R.I.INSUFFICIENT_CREDITS),E()},eT=async e=>{if(eu&&!$&&!eI.files.length){if(el){es({prompt:e.prompt,files:e.files,feature:M.VS.IMAGE_GENERATION}),ei({baseRedirectUrl:G.H7.IMAGE,redirectSearchParams:{[s.Ro.ASPECT_RATIO]:ea.value,[y.t.SHOULD_CARRY_FORWARD]:"true"},redirectWithAuth:!0});return}if(Z!==H.Sz.PRO||z(v.D.IMAGES)||T.Am.warning("Insufficient tokens. Upgrade your plan or purchase tokens via top-up."),Y&&!z(v.D.IMAGES)){ef();return}t||localStorage.removeItem(O.d.IMAGE_GEN_EDIT_IMAGE_IN_CHAT),eo.reset(),eg(),await K({prompt:e.prompt,files:e.files})}};return(0,d.useEffect)(()=>{let e,t;let l=er();if(c){let t=r.findLast(e=>e.value===Number(c));t&&!a({isPro:null==t?void 0:t.isPro})&&(ee(t),e=t)}if(_){let e=n.find(e=>e.value===_);e&&(et(e),t=e)}if(!Y||!i||!(null==l?void 0:l.prompt)||(null==l?void 0:l.feature)!==M.VS.IMAGE_GENERATION||eI.files.length||$)return;if(J(v.D.IMAGES)){ef();return}let u=new URL(window.location.href);if(u.searchParams.delete(s.Ro.MODEL),u.searchParams.delete(s.Ro.ASPECT_RATIO),o.replace(u.pathname+u.search),null==l?void 0:l.shouldNotRun){l.prompt&&eo.setValue(F.mk.PROMPT,l.prompt),l.files&&l.files.length&&eo.setValue(F.mk.FILES,l.files),en();return}(null==l?void 0:l.files)&&l.files.length?K({prompt:l.prompt,files:l.files,model:e,aspectRatio:t}):K({prompt:l.prompt,model:e,aspectRatio:t}),en()},[c,i,_]),(0,d.useEffect)(()=>{eg(),eo.reset()},[]),(0,d.useEffect)(()=>{(null==ec?void 0:ec.length)&&eA(()=>ec.map(e=>({id:e.id,name:e.name,type:e.mimetype,url:e.file_url.url})))},[eA,ec]),{formHook:eo,generatingResponse:$,prompt:eu,disabled:!eu||!!eI.files.length||$,onSubmit:eT,imageGenPresetsData:q,openFilePicker:e_,files:ec,removeFile:ep,onFilePaste:eE,uploadingFiles:eI,formRef:X}},Z=e=>{let{isInspirations:t=!1,isLandingPage:a=!1,aspectRatioRef:i}=e,{formHook:o,onSubmit:l,prompt:u,disabled:c,generatingResponse:d,openFilePicker:m,files:_,removeFile:p,onFilePaste:E,uploadingFiles:g,formRef:A}=Y({isInspirations:t});return(0,r.jsx)("div",{ref:A,className:"relative flex w-screen flex-col items-center justify-end gap-6 px-4 tablet:w-full tablet:max-w-[704px] tablet:gap-8 tablet:px-0 desktop-sm:max-w-[768px]",children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(n.s.Root,{clearOnSubmit:!1,allowMessageStop:!1,allowConcurrentPrompts:!0,allowFilesUpload:!0,files:_,formHook:o,onSubmit:l,removeFile:p,prompt:u,disabled:c,generatingResponse:d,shouldShowTooltipAnimation:!1,className:s.SO.promptBox,openFilePicker:m,onFilePaste:E,uploadingFiles:g,showModelDropdown:!a,children:(0,r.jsx)(n.s.Settings.Root,{className:"w-full justify-between",children:(0,r.jsx)(I,{aspectRatioRef:i})})})})})}},9842:function(e,t,a){a.d(t,{HB:function(){return s},Io:function(){return i},ek:function(){return o}});var r=a(55720),n=a(92939);let s=async e=>{let{id:t,type:a}=e,s=new URLSearchParams({["".concat(a,"_id")]:t}),{data:i}=await r.p.get("/asset/status?".concat(s.toString()),{},{throwOnError:!0});return"message"===a||"asset"===a?i:(0,n.sK)(i)},i=async e=>{let{data:t}=await r.p.get("/asset/chat/".concat(e,"/message"),{},{throwOnError:!0});return t},o=async e=>{let t=new FormData;t.append("data",JSON.stringify(e));let{data:a}=await r.p.post("/asset/chat/title",{body:t},{throwOnError:!0});return a}},28860:function(e,t,a){var r,n,s,i,o,l;a.d(t,{LZ:function(){return n},Ov:function(){return r},uc:function(){return s}}),(i=r||(r={})).CREATE="create",i.CLARIFY="clarify",i.EDIT="edit",i.MULTI_IMAGE_EDIT="multi_image_edit",(o=n||(n={})).PENDING="pending",o.PROCESSING="processing",o.FINISHED="finished",o.ERROR="error",(l=s||(s={})).UNIDENTIFIED="unidentified",l.IMAGE_GENERATION="text_to_image_generation",l.IMAGE_EDITS="image_to_image_edits",l.BACKGROUND_REMOVE="background_remover",l.IMAGE_UPSCALE="image_upscale",l.TEXT_TO_VIDEO="text_to_video_generation",l.IMAGE_TO_VIDEO="image_to_video_generation"},78435:function(e,t,a){a.d(t,{W:function(){return n}});var r=a(21568);let n=r.ZP.object({code:r.ZP.number(),message:r.ZP.string(),details:r.ZP.array(r.ZP.string()).optional().nullable()})},92939:function(e,t,a){a.d(t,{L4:function(){return s},sK:function(){return i}});var r=a(28860);let n=e=>{let t={};return e.forEach(e=>{if(e.message!==r.LZ.ERROR){if(e.message_id in t){t[e.message_id].push(e);return}t[e.message_id]=[e]}}),t},s=e=>{if(e.length<=2)return e;let t=new Set(e.map(e=>e.base_asset_id).filter(Boolean));return 0===t.size?e:e.filter(e=>!t.has(e.id))},i=e=>{let t=n(e);return Object.entries(t).forEach(e=>{let[a,r]=e;t[a]=s(r)}),t}}}]);