"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1393],{3218:function(e,t,r){r.d(t,{yo:function(){return c},sw:function(){return _},Sv:function(){return O},ue:function(){return A},Ei:function(){return h},Tu:function(){return E},bC:function(){return T},aM:function(){return d}});var n=r(10250),a=r(83635),o=r(21956),s=r(54679),i=r(47897),l=r(15751);let u=(0,r(7734).j)("fixed z-50 gap-4 bg-surface-elevated shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500 overflow-hidden",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border border-secondary rounded-t-2xl data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),c=a.fC,d=a.xz,_=a.x8,f=a.h_,m=(0,o.forwardRef)((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)(a.aV,{className:(0,l.cn)("fixed inset-0 z-50 bg-overlay backdrop-blur-[2px] data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...o,ref:t})});m.displayName=a.aV.displayName;let A=(0,o.forwardRef)((e,t)=>{let{side:r="right",className:o,children:s,...i}=e;return(0,n.jsxs)(f,{children:[(0,n.jsx)(m,{}),(0,n.jsx)(a.VY,{ref:t,className:(0,l.cn)(u({side:r}),o),...i,children:s})]})});A.displayName=a.VY.displayName;let E=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 border border-primary px-5 py-1.5 text-center sm:text-left",t),...r})};E.displayName="SheetHeader";let O=e=>{let{className:t}=e;return(0,n.jsx)(_,{asChild:!0,className:"!mt-0",children:(0,n.jsxs)(s.Button,{variant:"ghost",size:"icon-sm",shape:"pill",className:t,children:[(0,n.jsx)(i.b,{className:"size-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})})};O.displayName="SheetCloseButton";let T=(0,o.forwardRef)((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)(a.Dx,{ref:t,className:(0,l.cn)("text-body-lg font-medium",r),...o})});T.displayName=a.Dx.displayName;let h=(0,o.forwardRef)((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)(a.dk,{ref:t,className:(0,l.cn)("text-sm text-slate-500 dark:text-slate-400",r),...o})});h.displayName=a.dk.displayName},46045:function(e,t,r){r.d(t,{T:function(){return o}});var n=r(10250),a=r(76337);let o=e=>{let{children:t}=e;return(0,n.jsx)(a.f,{children:t})}},28110:function(e,t,r){r.d(t,{_:function(){return d},k:function(){return _}});var n=r(51897),a=r(91074);let o=n.x.NEXT_PUBLIC_CHAT_API_PATH,s=n.x.NEXT_PUBLIC_FREE_CHAT_API_PATH,i=new URL("".concat(n.x.NEXT_PUBLIC_APP_API_ENDPOINT,"/agent/completions")).href,l=new URL("".concat(n.x.NEXT_PUBLIC_APP_API_ENDPOINT).concat(s)).href,u="".concat(o,"/").concat(a.P.AI_CHAT),c=new URL("".concat(n.x.NEXT_PUBLIC_APP_API_ENDPOINT,"/apps/completions")).href,d={CHAT_COMPLETION_URL:i,CHAT_SYNC_URL:u,CHAT_DELETE_URL:"".concat(o),FREE_CHAT_COMPLETION_URL:l,CHAT_SUMMARY_URL:"".concat(o,"/summary"),CHAT_MEMORY_URL:"".concat(o,"/memories")},_={MINI_APP_COMPLETION_URL:c}},1844:function(e,t,r){r.d(t,{$:function(){return a},c:function(){return n}});let n={MODEL:"model",MODE:"mode"},a=3},91074:function(e,t,r){r.d(t,{P:function(){return a},y:function(){return n}});let n={USER:"user",ASSISTANT:"assistant"},a={AI_CHAT:"agent-chat",IMAGE_CHAT:"image-chat",DOC_CHAT:"doc-chat"}},63856:function(e,t,r){var n,a;r.d(t,{W:function(){return n},t:function(){return o}}),(a=n||(n={})).DAILY_LIMIT="dailyLimit",a.DISCOUNT_MODAL="discountModal",a.PRO_MODAL="proModal",a.BASIC_TO_STANDARD_MODAL="basicToStandardModal",a.HISTORY_POPOVER="historyPopover",a.USAGE_POPOVER="usagePopover",a.CHAT_DELETE_DIALOG="chatDeleteDialog",a.FULL_VIEW_IMAGE_DIALOG="fullViewImageDialog",a.ONBOARDING_MODAL="onboardingModal",a.MOBILE_APP_DOWNLOAD="mobileAppDownload",a.GROWTH_CAMPAIGN_MODAL="growthCampaignModal",a.FEEDBACK_MODAL="feedbackModal",a.FEEDBACK_POPOVER="feedbackPopover",a.SUBSCRIPTION_POPUP="subscriptionPopup",a.IMAGE_GEN_LIMIT_MODAL="imageGenLimitModal",a.SETTINGS_DIALOG="settingsDialog",a.IMAGE_INSPIRATION_FULL_VIEW="imageInspirationFullView",a.IMAGE_GEN_ONBOARDING_MODAL="imageGenOnboardingModal",a.DOC_EXPORT_MODAL="docExportModal",a.CHAT_MEDIA_CAROUSEL="chatMediaCarousel",a.DOCS_INSPIRATION_FULL_VIEW="docsInspirationFullView",a.MANAGE_MEMORIES="manageMemories",a.MINI_APP_FORM_OUTPUT_FULL_VIEW="miniAppFormOutputFullView",a.CLEAR_DOCS_CHAT="clearDocsChat";let o={OPEN:"openGlobalModal"}},28886:function(e,t,r){var n,a,o;r.d(t,{VS:function(){return n},r8:function(){return a},y8:function(){return s}}),(o=n||(n={})).AI_CHAT="aiChat",o.IMAGE_GENERATION="imageGeneration",o.AI_DOCS="aiDocs",(a||(a={})).MINI_APPS="miniApps";let s={CHATBASE:"chatbase"}},15135:function(e,t,r){r.d(t,{s:function(){return n}});let n={CARRY_FORWARD_DATA:"carry-forward-data",IMAGE_GEN_CARRY_FORWARD:"image-gen-carry-forward",MINI_APP_SHEET_OPENED_FROM_LIST:"mini-app-sheet-opened-from-list"}},41471:function(e,t,r){r.d(t,{N:function(){return o}});var n=r(28886),a=r(43192);let o={[n.VS.AI_CHAT]:a.H7.CHAT,[n.VS.IMAGE_GENERATION]:a.H7.IMAGE,[n.VS.AI_DOCS]:a.H7.DOCS}},71338:function(e,t,r){r.d(t,{I:function(){return a},d:function(){return n}});let n=36e5,a=864e5},54498:function(e,t,r){r.d(t,{s:function(){return n}});class n{addModel(e){this.map[e.name.toLowerCase()]=e,this.setDefaultModel()}getModelByName(e){var t;return null!==(t=this.map[e.toLowerCase()])&&void 0!==t?t:this.defaultModel}getModelByKey(e){var t;return null!==(t=Object.values(this.map).find(t=>t.model===e))&&void 0!==t?t:this.defaultModel}getDefaultModel(){return this.defaultModel}getModelByGuestUserKey(e){var t;return null!==(t=Object.values(this.map).find(t=>t.guestUserKey===e))&&void 0!==t?t:this.defaultModel}getModelByFreeUserKey(e){var t;return null!==(t=Object.values(this.map).find(t=>t.freeUserKey===e))&&void 0!==t?t:this.defaultModel}getModelByUtmParam(e){var t;return null!==(t=Object.values(this.map).find(t=>t.utmParam===e))&&void 0!==t?t:this.defaultModel}setDefaultModel(){var e;let t=Object.values(this.map);this.defaultModel=null!==(e=t.find(e=>e.default))&&void 0!==e?e:t[0]}constructor(e){this.map=e.reduce((e,t)=>(e[t.name.toLowerCase()]=t,e),{}),this.setDefaultModel()}}},21633:function(e,t,r){r.d(t,{R:function(){return d},j:function(){return _}});var n=r(10250),a=r(57331),o=r(21956),s=r(1844),i=r(35609),l=r(20225),u=r(54498);let c=(0,o.createContext)(void 0),d=e=>{let{children:t}=e,{models:r}=(0,l.Td)()(e=>({models:e.models})),d=(0,o.useMemo)(()=>new u.s(r),[r]),_=(0,a.useSearchParams)(),{isUtmModelFlow:f,utmModel:m}=(0,i.o)(),[A,E]=(0,o.useState)(null),[O,T]=(0,o.useState)(!1),h=_.get(s.c.MODEL),[I,g]=(0,o.useState)(()=>h?d.getModelByName(h):f&&m?d.getModelByUtmParam(m):d.getDefaultModel()),[p,M]=(0,o.useState)(!1),L=(0,o.useMemo)(()=>r.find(e=>e.isSearchEngineModel),[r]),N=(0,o.useMemo)(()=>e=>f?d.getModelByFreeUserKey(e):p?d.getModelByGuestUserKey(e):d.getModelByKey(e),[d,f,p]),C=(0,o.useMemo)(()=>{let e=new Map;return r.forEach(t=>{e.has(t.provider)||e.set(t.provider,t.image)}),Array.from(e.entries()).map(e=>{let[t,r]=e;return{name:t,image:r}})},[r]);(0,o.useEffect)(()=>{let e=_.get(s.c.MODEL);e&&g(d.getModelByName(e))},[_,d]);let y=(0,o.useMemo)(()=>({defaultModel:d.getDefaultModel(),currentModelInfo:I,setCurrentModel:e=>g(d.getModelByName(e)),currentPromptPreset:A,setCurrentPromptPreset:E,getModelInfoByName:e=>d.getModelByName(e),getModelInfo:N,resetChatStates:()=>{g(d.getDefaultModel())},isModelPageChat:O,setIsModelPageChat:T,isLandingPageChat:p,setIsLandingPageChat:M,searchEngineModel:null!=L?L:d.getDefaultModel(),providers:C}),[I,A,d,O,p,N,L,C]);return(0,n.jsx)(c.Provider,{value:y,children:t})},_=()=>{let e=(0,o.useContext)(c);if(void 0===e)throw Error("useChatConfigContext must be used within a ChatConfigContext");return e}},47451:function(e,t,r){r.d(t,{a:function(){return E}});var n=r(10276),a=r(57331),o=r(21956),s=r(80950),i=r(61206),l=r(4206),u=r(43192),c=r(1820),d=r(12178),_=r(77177),f=r(62819),m=r(12072),A=r(2350);let E=()=>{let e=(0,a.useRouter)(),{aggregator:t}=(0,d.O)(),r=(0,a.usePathname)(),E=(0,f.m)()(e=>e.user),O=(0,f.m)()(e=>e.logoutUser),T=(0,o.useCallback)(()=>{let e=E.id,t=(0,m.Cc)(e);localStorage.removeItem(t),sessionStorage.removeItem(l.H.HAS_INITIATED_CHECKOUT)},[E]);return(0,o.useCallback)(()=>{(0,_.kS)().catch(()=>{});try{(0,n.Kz)(),O()}catch(e){s.Am.error("Failed to logout")}T();let a=new URLSearchParams(window.location.search).get(c.t.UTM_MODEL);if(a){let t="";switch(!0){case r.includes(u.H7.IMAGE):t=u.H7.IMAGE;break;case r.includes(u.H7.DOCS):t=u.H7.DOCS;break;default:t=u.H7.ROOT}let n=new URL(t,window.location.origin),o=new URLSearchParams;o.set(c.t.UTM_MODEL,a),o.forEach((e,t)=>{n.searchParams.set(t,e)}),e.push((0,A.YF)(u.H7.AUTH,{[c.t.REDIRECT]:n.href}));return}e.push(u.H7.AUTH),t.log(i.H.logout)},[t,O,e,r,T])}},79148:function(e,t,r){r.d(t,{XA:function(){return _},Ln:function(){return d},az:function(){return f},Af:function(){return m}});var n,a,o=r(65598),s=r(79417),i=r(20273);(n=a||(a={})).GET_CHATS="get-chats",n.GET_MESSAGES="get-messages",n.GET_CHAT_MESSAGES="get-chat-messages",n.GET_TITLE="get-title",n.SAVE_TITLE="save-title",n.GET_CHAT_SUMMARY="get-chat-summary";var l=r(88733),u=r(20225);r(62819),r(88577);var c=r(91926);let d=()=>{let e=(0,u.Td)()(e=>e.isHistoryActive);return(0,o.D)({mutationFn:t=>e?(0,l.GO)(t):Promise.reject(Error("History is not active"))})},_=()=>{let e=(0,u.Td)()(e=>e.isHistoryActive);return(0,o.D)({mutationFn:t=>e?(0,l.Ss)(t):Promise.reject(Error("History is not active"))})},f=e=>{let{chatId:t,enabled:r=!0}=e,n=(0,u.Td)()(e=>e.isHistoryActive);return(0,s.a)({queryKey:[a.GET_CHAT_MESSAGES,t],queryFn:async()=>(0,l._U)(t),select:e=>e.data.messages,enabled:!!t&&r&&n,staleTime:0,refetchOnWindowFocus:!1})},m=()=>{let e=(0,i.NL)();return(0,o.D)({mutationKey:[c.A.UPDATE_MEMORY],mutationFn:l.xR,onSuccess:()=>{e.invalidateQueries({queryKey:[c.A.GET_ALL_MEMORIES]})}})}},28951:function(e,t,r){r.d(t,{Av:function(){return l},Ce:function(){return o},Ef:function(){return c},K3:function(){return _},Ws:function(){return s},dD:function(){return u},km:function(){return d},nw:function(){return i}});var n=r(5),a=r(64653);let o=()=>(0,n.ac)("(min-width: ".concat(a.n.desktop,")")),s=()=>(0,n.ac)("(min-width: ".concat(a.n.laptop,")")),i=()=>(0,n.ac)("(min-width: ".concat(a.n["desktop-sm"],")")),l=()=>(0,n.ac)("(min-width: ".concat(a.n.tablet,")")),u=()=>(0,n.ac)("(min-width: ".concat(a.n.mobile,")")),c=()=>(0,n.ac)("(min-width: ".concat(a.n.tablet,") and (max-width: calc(").concat(a.n.laptop," - 1px))")),d=()=>(0,n.ac)("(min-width: ".concat(a.n.mobile,") and (max-width: calc(").concat(a.n.tablet," - 1px))")),_=()=>(0,n.ac)("(min-width: ".concat(a.n.xl,")"))},91926:function(e,t,r){var n,a;r.d(t,{A:function(){return n}}),(a=n||(n={})).GET_ALL_MEMORIES="all-memories",a.DELETE_MEMORY="delete-memory",a.DELETE_ALL="delete-all",a.UPDATE_MEMORY="update-memory"},38126:function(e,t,r){r.d(t,{H:function(){return o}});var n=r(21956),a=r(15135);let o=()=>({setCarryForward:(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.s.CARRY_FORWARD_DATA;try{let r=JSON.stringify(e);sessionStorage.setItem(t,r)}catch(e){}},[]),readCarryForward:(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.s.CARRY_FORWARD_DATA,t=sessionStorage.getItem(e);if(null===t)return null;try{return JSON.parse(t)}catch(e){return null}},[]),clearCarryForward:(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.s.CARRY_FORWARD_DATA;sessionStorage.removeItem(e)},[])})},51972:function(e,t,r){r.d(t,{R:function(){return d}});var n=r(21956),a=r(21633),o=r(83366),s=r(88733),i=r(57676),l=r(16246),u=r(79148),c=r(16522);let d=e=>{let{id:t,temperature:r,contextWindow:d=9,getHeaders:_,url:f,focusMode:m,ltmCount:A,tools:E,memoriesCount:O,isMemoryEnabled:T=!1}=e,[h,I]=(0,n.useState)(!1),[g,p]=(0,n.useState)([]),[M,L]=(0,n.useState)(),[N,C]=(0,n.useState)({}),[y,w]=(0,n.useState)(i.d.TOKEN),[D,S]=(0,n.useState)(!1),[P,R]=(0,n.useState)(!1),[v,b]=(0,n.useState)(!1),[U,x]=(0,n.useState)(null),[G,H]=(0,n.useState)(t),[B,k]=(0,n.useState)(null),{refetch:F}=(0,c.X)(),[W,V]=(0,n.useState)(""),K=(0,n.useRef)(0),j=(0,n.useRef)(0),{mutate:Y}=(0,u.Af)(),X=(0,n.useMemo)(()=>d%2==0?d+1:d,[d]),{isLandingPageChat:J}=(0,a.j)(),z=(0,n.useRef)(new AbortController),q=(0,n.useCallback)(e=>{let{newMessages:t,replace:r=!1}=e;p(e=>r?t:[...e,...t])},[]);t!==G&&(q({newMessages:[],replace:!0}),z.current.abort(),I(!1),L(void 0),H(t),k(null),S(!1),b(!1),x(null),V(""),K.current=0,j.current=0);let Z=(0,n.useCallback)(async e=>{let{updatedMessages:t,model:r,modelTemperature:n,summary:a,personality:s}=e;I(!0),k(null),b(!1),x(null),z.current.abort(),z.current=new AbortController;let i={id:"",content:{reasoning:"",token:"",citation:[],citation_video:[],tool_call:{},email_block:"",hand_off:"",tool_result:{web_results:[],image_results:[],video_results:[],related_searches:[]}},role:"assistant",model:r};L(i);try{let e=await (0,o.XY)({id:G,messages:t,temperature:n,controller:z.current,getHeaders:_,url:f,focusMode:m,isWebSearch:P,summary:a,personality:s}),r=await (0,o.LZ)({reader:e,currentMessage:i,setCurrentMessage:L,setCurrentContentType:w,setSourcesMap:C,setHasToolCallAfterToken:b,setCurrentToolName:x,controller:z.current,tools:E});if(!r.content)throw Error("Message response is empty");q({newMessages:[r],replace:!1})}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;k(e instanceof Error?e.message:"An error occurred while sending the message")}finally{L(void 0),I(!1),b(!1),x(null)}},[G,f,q,_,m,P,E]),Q=(0,n.useCallback)(async e=>{if(A&&2*A<=K.current){let{summary:t}=await (0,s.Rf)({chatId:G,messages:e.slice(-(2*A)),ltmSummary:W});V(t),K.current=0}},[W,G,A]),$=(0,n.useCallback)(async e=>{O&&T&&2*O<=j.current&&(Y({chatId:G,messages:e.slice(-(2*O))}),j.current=0)},[G,O,T,Y]),ee=(0,n.useCallback)(async e=>{let{message:t,model:n,personality:a}=e,o=[...g,{...t}];q({newMessages:o,replace:!0}),await Z({updatedMessages:o.slice(-X),model:n,modelTemperature:r,summary:W,personality:a}),J||(K.current+=2,j.current+=2,await Promise.all([Q(o),$(o),F()]))},[W,q,X,Z,g,r,F,J,Q,$]),et=(0,n.useCallback)(()=>{z.current.abort(),I(!1),M&&M.id&&M.content[i.d.TOKEN]?q({newMessages:[M],replace:!1}):q({newMessages:[],replace:!1}),L(void 0)},[M,q]),er=(0,n.useCallback)(async e=>{let{index:t,model:r,modelTemperature:n}=e,a=g.at(t-1);if(!a||"user"!==a.role)return;let o={id:(0,l.O)(),content:a.content,role:"user",model:r},s=[...g.slice(0,t-1),o];q({newMessages:s,replace:!0}),await Z({updatedMessages:s.slice(-X),model:r,modelTemperature:n,summary:W})},[q,X,Z,g,W]),en=(0,n.useCallback)(async e=>{let{index:t,model:r,modelTemperature:n}=e,a=g.slice(0,t+1);a[a.length-1].model=r,q({newMessages:a,replace:!0}),await Z({updatedMessages:a.slice(-X),model:r,modelTemperature:n,summary:W})},[q,X,Z,g,W]),ea=(0,n.useCallback)(async e=>{let{messageId:t,model:r,modelTemperature:n}=e;if(h)return;let a=g.find(e=>e.id===t);if(!a)return;let o=g.findIndex(e=>e.id===t);"assistant"===a.role?await er({index:o,model:r,modelTemperature:n}):"user"===a.role&&await en({index:o,model:r,modelTemperature:n})},[h,g,er,en]);return{messages:M?[...g,M]:[...g],loading:h,currentContentType:y,currentToolName:U,stopMessage:et,sendMessage:ee,error:B,regenerateMessage:ea,appendMessages:q,isReasoning:D,isWebSearch:P,setIsWebSearch:R,hasToolCallAfterToken:v,sourcesMap:N,setSourcesMap:C,setChatSummary:V}}},59480:function(e,t,r){r.d(t,{V:function(){return n}});async function*n(e){let{isAborted:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new TextDecoder,n="";for(;;){if(null==t?void 0:t()){await e.cancel();break}let{value:a,done:o}=await e.read();if(o)break;let s=(n+=r.decode(a,{stream:!0})).indexOf("\n\n");for(;-1!==s;){let e=n.slice(0,s);for(let t of(n=n.slice(s+2),e.split("\n")))if(t.startsWith("data: ")){let e=JSON.parse(t.substring(6));yield e;break}s=n.indexOf("\n\n")}}}},83366:function(e,t,r){r.d(t,{MA:function(){return u},XY:function(){return c},ak:function(){return i},LZ:function(){return l}});var n=r(53588),a=r(59480);let o="vgpt-a1-1";var s=r(57676);let i=async e=>{let{response:t,content:r,setSourcesMap:a,tools:o}=e;switch(t.type){case s.d.REASONING:r[s.d.REASONING]+=t.content;break;case s.d.TOKEN:r[s.d.TOKEN]+=t.content;break;case s.d.CITATION:{let e=JSON.parse(t.content);r[s.d.TOKEN]+="[".concat(e.title,"](cite://").concat(e.url,")"),r[s.d.CITATION].every(t=>t.url!==e.url)&&r[s.d.CITATION].push(e);break}case s.d.CITATION_IMAGE:{let e=JSON.parse(t.content);r[s.d.TOKEN]+="![cite-image://".concat(e.title,"](").concat(e.url,")");break}case s.d.CITATION_VIDEO:{let e=JSON.parse(t.content),a=(0,n.Qc)(e.url).domainWithoutSuffix;if(!("youtube"===a||"youtu"===a))return;r[s.d.CITATION_VIDEO].push(e);break}case s.d.TOOL_CALL:t.tool in r[s.d.TOOL_CALL]?r[s.d.TOOL_CALL][t.tool].push(t.content):r[s.d.TOOL_CALL][t.tool]=[t.content];break;case s.d.TOOL_RESULT:{if(t.tool!==o.webSearch)return;let e=JSON.parse(t.content),n=r[s.d.TOOL_RESULT];r[s.d.TOOL_RESULT]={web_results:[...n.web_results,...e.web_results],image_results:[...n.image_results,...e.image_results],video_results:[...n.video_results,...e.video_results],related_searches:[...n.related_searches,...e.related_searches]},a(r=>{var n;let a=null!==(n=r[t.id])&&void 0!==n?n:{web_results:[],image_results:[],video_results:[],related_searches:[]};return{...r,[t.id]:{web_results:[...a.web_results,...e.web_results],image_results:[...a.image_results,...e.image_results],video_results:[...a.video_results,...e.video_results],related_searches:[...a.related_searches,...e.related_searches]}}});break}case s.d.EMAIL_BLOCK:r[s.d.EMAIL_BLOCK]+=t.content}},l=async e=>{var t;let{reader:r,currentMessage:n,setCurrentMessage:l,setCurrentContentType:u,setHasToolCallAfterToken:c,setCurrentToolName:d,controller:_,setSourcesMap:f,tools:m}=e,A={[s.d.REASONING]:"",[s.d.TOKEN]:"",[s.d.CITATION]:[],[s.d.CITATION_VIDEO]:[],[s.d.TOOL_CALL]:{},[s.d.TOOL_RESULT]:{web_results:[],image_results:[],video_results:[],related_searches:[]},[s.d.EMAIL_BLOCK]:"",[s.d.HAND_OFF]:""},E="",O=-1;for await(let e of(0,a.V)(r))E||(E=e.id),u(e.type),e.type===s.d.TOOL_CALL?(e.tool&&d(e.tool),A[s.d.TOKEN].length>0&&-1===O&&(O=A[s.d.TOKEN].length,c(!0))):e.type===s.d.TOKEN&&-1!==O&&(c(!1),d(null),O=-1),i({response:e,content:A,setSourcesMap:f,tools:m}),n&&!_.signal.aborted&&l({...n,id:E,content:{...A}});return{id:E,content:A,role:"assistant",model:null!==(t=null==n?void 0:n.model)&&void 0!==t?t:o}},u=e=>{let{id:t,messages:r,temperature:n,focusMode:a,isWebSearch:i,summary:l,personality:u}=e,c=new FormData,d=r.at(-1);return c.append("data",JSON.stringify({id:t,temperature:n,model:d.model,metadata:a?{focusMode:a}:void 0,web_search:i,ltm_summary:null!=l?l:"",messages:[...r.map(e=>{if("assistant"===e.role)return{...e,content:e.content[s.d.TOKEN],model:o};let t=e.content.map(e=>"file"===e.type?{type:"file",mimetype:e.mimetype,file_url:{url:e.file_url.url,meta_data:{name:e.name}}}:"image_url"===e.type?{type:"image_url",mimetype:e.mimetype,file_url:{url:e.file_url.url,meta_data:{name:e.name}}}:{type:"text",text:e.text}).filter(e=>e);return{id:e.id,model:a&&"writing"!==a?"se-".concat(a):o,role:"user",content:t}})],preferences:u})),c};async function c(e){let{id:t,messages:r,temperature:n,controller:a,getHeaders:o,url:s,focusMode:i,isWebSearch:l,summary:c,personality:d}=e,_=u({id:t,messages:r,temperature:n,focusMode:i,isWebSearch:l,summary:c,personality:d}),f=await fetch(s,{method:"POST",headers:{...o()},body:_,signal:a.signal});if(200!==f.status)throw Error((await f.json()).error.toString());if(!f.body)throw Error("Response body does not exist");return f.body.getReader()}},35609:function(e,t,r){r.d(t,{o:function(){return l}});var n=r(57331),a=r(21956),o=r(43192),s=r(1820),i=r(62819);let l=()=>{let e=(0,i.m)()(e=>e.subscription),t=(0,n.usePathname)(),r=(0,n.useSearchParams)(),l=(0,n.useRouter)();(0,a.useEffect)(()=>{let t=r.get(s.t.UTM_MODEL);if((null==e?void 0:e.isActive)&&t){let e=new URLSearchParams(r.toString());e.delete(s.t.UTM_MODEL),l.replace("?".concat(e.toString()),{scroll:!1})}},[e,r,l]);let u=(0,a.useMemo)(()=>{if(!0===t.includes(o.H7.IMAGE)){let e=r.get(s.t.UTM_MODEL);return null==e?void 0:e.replace(/^(a_|b_)/,"")}return r.get(s.t.UTM_MODEL)},[r,t]);return{isUtmModelFlow:!!u,utmModel:u,fullUtmModel:r.get(s.t.UTM_MODEL)}}},16522:function(e,t,r){r.d(t,{X:function(){return u},p:function(){return c}});var n=r(79417),a=r(65598),o=r(71338),s=r(70577),i=r(62819),l=r(86213);let u=()=>{let e=(0,i.m)()(e=>e.user);return(0,n.a)({queryKey:[l.D.GET_CREDITS],queryFn:s.rW,staleTime:o.d,enabled:!!e})},c=()=>(0,a.D)({mutationKey:[l.D.UPDATE_SETTINGS],mutationFn:s.d2})},86213:function(e,t,r){var n,a;r.d(t,{D:function(){return n}}),(a=n||(n={})).GET_CREDITS="get-credits",a.GET_SETTINGS="get-settings",a.UPDATE_SETTINGS="update-settings"},35787:function(e,t,r){r.d(t,{f:function(){return a}});var n=r(10250);let a=e=>{let{className:t}=e;return(0,n.jsx)("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 18 18",className:t,children:(0,n.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",d:"m12.48 5.522-7.19 7.19m7.954-1.59-.272-5.342c0-.684 0-.684-.75-.75L6.88 4.757"})})}},11723:function(e,t,r){r.d(t,{p:function(){return a}});var n=r(10250);let a=e=>{let{className:t}=e;return(0,n.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",className:t,children:(0,n.jsx)("path",{d:"M3.75 9h10.5M9 3.75v10.5",stroke:"currentColor",strokeWidth:"currentStroke",strokeLinecap:"round",strokeLinejoin:"round"})})}},54210:function(e,t,r){r.d(t,{f:function(){return s}});var n=r(51897),a=r(65714),o=r(57914);let s=new a.h({baseURL:n.x.NEXT_PUBLIC_APP_API_ENDPOINT,defaultHeadersGenerator:o.A})},88733:function(e,t,r){r.d(t,{Ss:function(){return m},_E:function(){return g},GO:function(){return f},lo:function(){return I},BB:function(){return u},Rf:function(){return E},mB:function(){return h},_U:function(){return _},cY:function(){return d},xR:function(){return O},gf:function(){return c},dA:function(){return A},_x:function(){return T}});var n=r(28110),a=r(51897),o=r(83366),s=r(57914);let i=new(r(65714)).h({baseURL:"".concat(a.x.NEXT_PUBLIC_APP_API_ENDPOINT,"/chat"),defaultHeadersGenerator:s.A});var l=r(54210);let u=async e=>{let{feature:t,searchTerm:r}=e,{data:n}=await l.f.get("".concat(a.x.NEXT_PUBLIC_CHAT_API_PATH,"/").concat(null!=t?t:"all-chat").concat(r?"/search?q=".concat(r):""),{},{throwOnError:!0});return n},c=async e=>{let{id:t,messages:r,isWebSearch:n=!1}=e,s=(0,o.MA)({id:t,messages:r,isWebSearch:n});return await l.f.post("".concat(a.x.NEXT_PUBLIC_CHAT_API_PATH,"/titles"),{body:s},{throwOnError:!0})},d=async e=>{let{chatId:t,title:r}=e,n=new FormData;n.append("title",r);let{data:o}=await l.f.patch("".concat(a.x.NEXT_PUBLIC_CHAT_API_PATH,"/").concat(t,"/titles"),{body:n},{throwOnError:!0});return o},_=async(e,t)=>{let r=t?{Authorization:"Bearer ".concat(t)}:(0,s.A)();return await l.f.get("".concat(a.x.NEXT_PUBLIC_AGENT_API_PATH,"/").concat(e,"/messages"),{headers:r},{throwOnError:!0})},f=async e=>{let t="".concat(n._.CHAT_DELETE_URL,"/").concat(e);return await l.f.delete(t,{},{throwOnError:!0})},m=async e=>{let t="".concat(n._.CHAT_DELETE_URL,"/bulk");return await l.f.delete(t,{body:JSON.stringify({chat_ids:e})},{throwOnError:!0})},A=async e=>{let{chatId:t,pinned:r}=e,n=new FormData;return n.append("pinned",String(r)),await l.f.patch("".concat(a.x.NEXT_PUBLIC_CHAT_API_PATH,"/").concat(t,"/pin"),{body:n},{throwOnError:!0})},E=async e=>{let{chatId:t,messages:r,ltmSummary:a}=e,o=new FormData;o.append("history",JSON.stringify({chat_id:t,previous_summary:a,messages:r}));let{data:s}=await l.f.post(n._.CHAT_SUMMARY_URL,{body:o},{throwOnError:!0});return s},O=async e=>{let{chatId:t,messages:r}=e,a=new FormData;a.append("history",JSON.stringify({chat_id:t,messages:r}));let{data:o}=await l.f.post(n._.CHAT_MEMORY_URL,{body:a},{throwOnError:!0});return o},T=async e=>{let{chatId:t,thumbnail:r}=e,n=new FormData;return n.append("thumbnail",r),await i.put("/".concat(t,"/thumbnail"),{body:n},{throwOnError:!0})},h=async()=>{let{data:e}=await i.get("/memories",void 0,{throwOnError:!0});return e},I=async e=>{let{data:t}=await i.delete("/memories/".concat(e),void 0,{throwOnError:!0});return t},g=async()=>{let{data:e}=await i.delete("/memories",void 0,{throwOnError:!0});return e}},70577:function(e,t,r){r.d(t,{Jc:function(){return c},s9:function(){return _},rW:function(){return l},Aq:function(){return u},AN:function(){return d},d2:function(){return f}});var n=r(51897),a=r(65714),o=r(57914);let s="".concat(n.x.NEXT_PUBLIC_APP_API_ENDPOINT).concat(n.x.NEXT_PUBLIC_USER_API_PATH),i=new a.h({baseURL:s,defaultHeadersGenerator:o.A}),l=async()=>{let{data:e}=await i.get("/credits",{},{throwOnError:!0});return e},u=async()=>{let{data:e}=await i.get("/preferences",void 0,{throwOnError:!0});return e},c=async e=>{let{name:t,occupation:r,traits:n,additionalContext:a,presetName:o}=e,s=new FormData;s.set("preferences",JSON.stringify({name:t,occupation:r,traits:n,additional_context:a,preset_name:o}));let{data:l}=await i.post("/preferences",{body:s},{throwOnError:!0});return l},d=async e=>{let{name:t,occupation:r,traits:n,additionalContext:a,presetName:o,id:s}=e,l=new FormData;l.set("preferences",JSON.stringify({name:t,occupation:r,traits:n,additional_context:a,preset_name:o}));let{data:u}=await i.put("/preferences/".concat(s),{body:l},{throwOnError:!0});return u},_=async e=>{let{data:t}=await i.delete("/preferences/".concat(e),void 0,{throwOnError:!0});return t},f=async e=>{let{memoryEnabled:t,selectedPersonalization:r}=e,n=new FormData,a={};t&&(a.memories_enabled=t),r&&(a.selected_personalization=r),n.set("settings",JSON.stringify(a));let{data:o}=await i.put("/settings",{body:n},{throwOnError:!0});return o}},4062:function(e,t,r){r.d(t,{r:function(){return n}});let n=(0,r(79391).Ue)((e,t)=>({showTurnstile:!1,setShowTurnstile:t=>e({showTurnstile:t}),token:"",setToken:t=>e({token:t}),onVerify:()=>{},setOnVerify:t=>e({onVerify:t}),captchaAction:async r=>{let{token:n}=t();if(n.length>0){r();return}e({onVerify:r}),e({showTurnstile:!0})}}))},9540:function(e,t,r){r.d(t,{I:function(){return s}});var n=r(79391),a=r(63856),o=r(33630);let s=(0,n.Ue)()((e,t)=>({dialogs:{[a.W.DAILY_LIMIT]:!1,[a.W.DISCOUNT_MODAL]:!1,[a.W.PRO_MODAL]:!1,[a.W.HISTORY_POPOVER]:!1,[a.W.CHAT_DELETE_DIALOG]:!1,[a.W.FULL_VIEW_IMAGE_DIALOG]:!1,[a.W.USAGE_POPOVER]:!1,[a.W.ONBOARDING_MODAL]:!1,[a.W.MOBILE_APP_DOWNLOAD]:!1,[a.W.GROWTH_CAMPAIGN_MODAL]:!1,[a.W.FEEDBACK_MODAL]:!1,[a.W.FEEDBACK_POPOVER]:!1,[a.W.SUBSCRIPTION_POPUP]:!1,[a.W.BASIC_TO_STANDARD_MODAL]:!1,[a.W.IMAGE_GEN_LIMIT_MODAL]:!1,[a.W.SETTINGS_DIALOG]:!1,[a.W.IMAGE_INSPIRATION_FULL_VIEW]:!1,[a.W.IMAGE_GEN_ONBOARDING_MODAL]:!1,[a.W.DOC_EXPORT_MODAL]:!1,[a.W.CHAT_MEDIA_CAROUSEL]:!1,[a.W.DOCS_INSPIRATION_FULL_VIEW]:!1,[a.W.MANAGE_MEMORIES]:!1,[a.W.MINI_APP_FORM_OUTPUT_FULL_VIEW]:!1,[a.W.CLEAR_DOCS_CHAT]:!1},openDialog:t=>e(e=>({dialogs:{...e.dialogs,[t]:!0}})),closeDialog:t=>e(e=>({dialogs:{...e.dialogs,[t]:!1}})),setDialogOpen:(t,r)=>e(e=>({dialogs:{...e.dialogs,[t]:r}})),toggleDialog:t=>e(e=>({dialogs:{...e.dialogs,[t]:!e.dialogs[t]}})),isDialogOpen:e=>t().dialogs[e],isAnyDialogOpen:()=>Object.values(t().dialogs).some(e=>e),closeAll:()=>e(e=>({dialogs:(0,o.s4)(e.dialogs).reduce((e,t)=>({...e,[t]:!1}),{})}))}))},20225:function(e,t,r){r.d(t,{Td:function(){return l},hO:function(){return u}});var n=r(10250),a=r(21956),o=r(79391);let s=e=>(0,o.Ue)(()=>({...e})),i=(0,a.createContext)(null),l=()=>{if(!i)throw Error("useRemoteConfigStoreContext must be used within a RemoteConfigStoreProvider");return(0,a.useContext)(i)},u=e=>{let{initialState:t,children:r}=e,[o]=(0,a.useState)(()=>s(t));return(0,n.jsx)(i.Provider,{value:o,children:r})}},57676:function(e,t,r){var n,a;r.d(t,{d:function(){return n}}),(a=n||(n={})).REASONING="reasoning",a.TOKEN="token",a.CITATION="citation",a.CITATION_IMAGE="citation_image",a.CITATION_VIDEO="citation_video",a.TOOL_CALL="tool_call",a.TOOL_RESULT="tool_result",a.DOC="doc",a.EMAIL_BLOCK="email_block",a.HAND_OFF="hand_off"},88577:function(e,t,r){r.d(t,{Nr:function(){return o},_2:function(){return a},rL:function(){return s}});var n=r(51897);r(88733);let a=e=>{if("user"!==e.role)return!1;let t=!1;return e.content.forEach(e=>{("file"===e.type||"image_url"===e.type)&&(t=!0)}),t},o=e=>e?"assistant"===e.role?e.content.token:"text"===e.content[0].type?e.content[0].text:"":"",s=e=>"".concat(n.x.NEXT_PUBLIC_FAVICON_URL).concat(encodeURIComponent(e))},2350:function(e,t,r){r.d(t,{$O:function(){return c},GL:function(){return A},JE:function(){return m},Pu:function(){return f},YF:function(){return d},aw:function(){return E},qA:function(){return O}});var n=r(9786),a=r(85578),o=r(28886),s=r(43192),i=r(41471),l=r(51897),u=r(33630);let c=function(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return n?e.includes(t):r?e===t:e.startsWith(t)},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new URL(e,l.x.NEXT_PUBLIC_APP_URL);return Object.entries(t).forEach(e=>{let[t,r]=e;"object"==typeof r?n.searchParams.append(t,JSON.stringify(r)):n.searchParams.append(t,r)}),r?n.href:n.href.replace(l.x.NEXT_PUBLIC_APP_URL,"")},_=[a.Y.TERM,a.Y.CAMPAIGN],f=e=>{_.forEach(t=>{let r=e.get(t);r&&n.Z.set(t,r,{expires:30})})},m=e=>{let t=(0,u.Go)(i.N).find(t=>{let[r,n]=t;return c(e,n,!1)});return t?t[0]:o.VS.AI_CHAT},A=e=>s.ky.has(e)||s.nY.some(t=>e.includes(t)),E=e=>!(s.NB.some(t=>e.includes(t))||e===s.H7.ROOT),O=e=>s.NB.some(t=>e.includes(t))||e===s.H7.ROOT}}]);