define("discourse/plugins/discourse-user-notes/discourse/adapters/user-note",["exports","discourse/adapters/rest","discourse/lib/ajax"],function(e,s,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends s.default{destroyRecord(e,s,o){const r=this.pathFor(e,s,o.id)
return(0,t.ajax)(`${r}?user_id=${o.user_id}`,{method:"DELETE"})}}e.default=o}),define("discourse/plugins/discourse-user-notes/discourse/components/modal/user-notes",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-modal","discourse/components/form","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/lib/transformer","discourse-i18n","discourse/plugins/discourse-user-notes/discourse/components/user-note","@ember/component","@ember/template-factory"],function(e,s,t,o,r,n,i,u,d,c,l,a,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends s.default{static{dt7948.g(this.prototype,"dialog",[o.service])}#e=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"store",[o.service])}#s=void dt7948.i(this,"store")
#t(){this.args.model.callback?.(this.args.model.note.length)}get subtitle(){return(0,d.applyValueTransformer)("user-notes-modal-subtitle","",{model:this.args.model})}registerApi(e){this.formApi=e}static{dt7948.n(this.prototype,"registerApi",[t.action])}async onSubmit(e){const s=this.store.createRecord("user-note"),t={raw:e.content,user_id:parseInt(this.args.model.userId,10)}
this.args.model.postId&&(t.post_id=parseInt(this.args.model.postId,10))
try{await s.save(t),await this.formApi.set("content",""),this.args.model.note.unshift(s),this.#t()}catch(o){(0,i.popupAjaxError)(o)}}static{dt7948.n(this.prototype,"onSubmit",[t.action])}removeNote(e){this.dialog.deleteConfirm({message:(0,c.i18n)("user_notes.delete_confirm"),didConfirm:()=>{e.destroyRecord().then(()=>{(0,u.removeValueFromArray)(this.args.model.note,e),this.#t()}).catch(i.popupAjaxError)}})}static{dt7948.n(this.prototype,"removeNote",[t.action])}static{(0,a.setComponentTemplate)((0,p.createTemplateFactory)({id:"1Ffak6N2",block:'[[[8,[32,0],[[24,0,"user-notes-modal"]],[["@closeModal","@title","@subtitle"],[[30,1],[28,[32,1],["user_notes.title"],null],[30,0,["subtitle"]]]],[["default"],[[[[1,"\\n  "],[8,[32,2],null,[["@onSubmit","@onRegisterApi"],[[30,0,["onSubmit"]],[30,0,["registerApi"]]]],[["default"],[[[[1,"\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@format","@validation"],["content",[28,[32,1],["user_notes.attach_note_description"],null],"full","required:trim"]],[["default"],[[[[1,"\\n      "],[8,[30,3,["Textarea"]],null,null,null],[1,"\\n    "]],[3]]]]],[1,"\\n\\n    "],[8,[30,2,["Actions"]],null,null,[["default"],[[[[1,"\\n      "],[8,[30,2,["Submit"]],[[24,0,"btn-primary"]],[["@label"],["user_notes.attach"]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "]],[2]]]]],[1,"\\n\\n"],[42,[28,[31,1],[[28,[31,1],[[30,4,["note"]]],null]],null],null,[[[1,"    "],[8,[32,3],null,[["@note","@removeNote"],[[30,5],[30,0,["removeNote"]]]],null],[1,"\\n"]],[5]],null]],[]]]]]],["@closeModal","form","field","@model","n"],["each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/components/modal/user-notes.js",scope:()=>[r.default,c.i18n,n.default,l.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-user-notes/discourse/components/post-metadata-user-notes",["exports","@glimmer/component","@ember/modifier","@ember/object","@ember/service","discourse/helpers/d-icon","discourse/helpers/emoji","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/component","@ember/template-factory"],function(e,s,t,o,r,n,i,u,d,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends s.default{static{dt7948.g(this.prototype,"siteSettings",[r.service])}#o=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"store",[r.service])}#s=void dt7948.i(this,"store")
showNotes(){(0,u.showUserNotes)(this.store,this.args.post.user_id,e=>(0,u.updatePostUserNotesCount)(this.args.post,e),{postId:this.args.post.id})}static{dt7948.n(this.prototype,"showNotes",[o.action])}static{(0,d.setComponentTemplate)((0,c.createTemplateFactory)({id:"2QYkQYC0",block:'[[[11,1],[24,0,"user-notes-icon"],[4,[32,0],["click",[30,0,["showNotes"]]],null],[12],[1,"\\n"],[41,[30,0,["siteSettings","enable_emoji"]],[[[1,"    "],[1,[28,[32,1],["memo"],null]],[1,"\\n"]],[]],[[[1,"    "],[1,[28,[32,2],["pen-to-square"],null]],[1,"\\n"]],[]]],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/components/post-metadata-user-notes.js",scope:()=>[t.on,i.default,n.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-user-notes/discourse/components/show-user-notes",["exports","@glimmer/component","discourse/components/d-button","discourse-i18n","@ember/component","@ember/template-factory"],function(e,s,t,o,r,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{get label(){return this.args.count>0?(0,o.i18n)("user_notes.show",{count:this.args.count}):(0,o.i18n)("user_notes.title")}static{(0,r.setComponentTemplate)((0,n.createTemplateFactory)({id:"mfwmkot/",block:'[[[8,[32,0],[[24,0,"btn-default show-user-notes-btn"]],[["@action","@icon","@translatedLabel"],[[30,1],"pen-to-square",[30,0,["label"]]]],null]],["@show"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/components/show-user-notes.js",scope:()=>[t.default],isStrictMode:!0}),this)}}e.default=i}),define("discourse/plugins/discourse-user-notes/discourse/components/user-note",["exports","@ember/helper","@ember/routing","discourse/components/cook-text","discourse/components/d-button","discourse/components/plugin-outlet","discourse/components/user-link","discourse/helpers/age-with-tooltip","discourse/helpers/avatar","discourse/helpers/lazy-hash","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,s,t,o,r,n,i,u,d,c,l,a,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const f=(0,a.setComponentTemplate)((0,p.createTemplateFactory)({id:"T0J3fSWo",block:'[[[8,[32,0],null,[["@name","@outletArgs"],["user-note-modal-wrapper",[28,[32,1],null,[["note","removeNote"],[[30,1],[30,2]]]]]],[["default"],[[[[1,"\\n  "],[10,0],[14,0,"user-note"],[12],[1,"\\n    "],[10,0],[14,0,"posted-by"],[12],[1,"\\n      "],[8,[32,2],null,[["@user"],[[30,1,["created_by"]]]],[["default"],[[[[1,"\\n        "],[1,[28,[32,3],[[30,1,["created_by"]]],[["imageSize"],["small"]]]],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"note-contents"],[12],[1,"\\n      "],[10,0],[14,0,"note-info"],[12],[1,"\\n        "],[10,1],[14,0,"username"],[12],[1,[30,1,["created_by","username"]]],[13],[1,"\\n        "],[10,1],[14,0,"post-date"],[12],[1,[28,[32,4],[[30,1,["created_at"]]],null]],[13],[1,"\\n"],[41,[30,1,["reviewable_id"]],[[[1,"          "],[8,[32,5],[[24,0,"btn btn-small btn-default show-reviewable"]],[["@route","@model"],["review.show",[30,1,["reviewable_id"]]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,6],["user_notes.show_flag"],null]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[41,[30,1,["can_delete"]],[[[1,"          "],[8,[32,7],[[24,0,"btn-small btn-danger"]],[["@action","@icon","@title"],[[28,[32,8],[[30,2],[30,1]],null],"far-trash-can","user_notes.remove"]],null],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n\\n      "],[10,0],[14,0,"cooked"],[12],[1,"\\n        "],[8,[32,9],null,[["@rawText"],[[30,1,["raw"]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,1,["post_id"]],[[[1,"        "],[10,3],[15,6,[30,1,["post_url"]]],[14,0,"btn btn-small"],[12],[1,"\\n          "],[1,[28,[32,6],["user_notes.show_post"],null]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"clearfix"],[12],[13],[1,"\\n  "],[13],[1,"\\n"]],[]]]]]],["@note","@removeNote"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/components/user-note.js",scope:()=>[n.default,c.default,i.default,d.default,u.default,t.LinkTo,l.i18n,r.default,s.fn,o.default],isStrictMode:!0}),(0,m.default)(void 0,"user-note:UserNote"))
e.default=f}),define("discourse/plugins/discourse-user-notes/discourse/connectors/after-reviewable-post-user/show-user-notes-on-flags",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/helpers/d-icon","discourse/lib/text","discourse-i18n","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/component","@ember/template-factory"],function(e,s,t,o,r,n,i,u,d,c,l,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const p=(0,u.emojiUrlFor)("memo")
class m extends s.default{static shouldRender(e,{siteSettings:s}){return s.user_notes_enabled&&e.user}static{dt7948.g(this.prototype,"store",[r.service])}#s=void dt7948.i(this,"store")
static{dt7948.g(this.prototype,"siteSettings",[r.service])}#o=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"userNotesCount",[t.tracked],function(){return this.args.user.get("custom_fields.user_notes_count")||0})}#r=void dt7948.i(this,"userNotesCount")
showUserNotes(){(0,c.showUserNotes)(this.store,this.args.user.id,e=>this.userNotesCount=e)}static{dt7948.n(this.prototype,"showUserNotes",[o.action])}static{(0,l.setComponentTemplate)((0,a.createTemplateFactory)({id:"8+nM1PGW",block:'[[[10,0],[14,0,"after-reviewable-post-user-outlet show-user-notes-on-flags"],[12],[1,"\\n"],[41,[30,0,["userNotesCount"]],[[[1,"    "],[8,[32,0],[[24,0,"btn-flat"]],[["@translatedTitle","@action"],[[28,[32,1],["user_notes.show"],[["count"],[[30,0,["userNotesCount"]]]]],[30,0,["showUserNotes"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["siteSettings","enable_emoji"]],[[[1,"        "],[10,"img"],[15,"src",[32,2]],[15,"title",[28,[32,1],["user_notes.show"],[["count"],[[30,0,["userNotesCount"]]]]]],[14,"alt",""],[14,0,"emoji"],[12],[13],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[32,3],["pen-to-square"],null]],[1,"\\n"]],[]]],[1,"    "]],[]]]]],[1,"\\n"]],[]],null],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/after-reviewable-post-user/show-user-notes-on-flags.js",scope:()=>[n.default,d.i18n,p,i.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-user-notes/discourse/connectors/reviewable-note-form-after-note/copy-reviewable-note-to-user-option",["exports","@glimmer/component","discourse-i18n","@ember/component","@ember/template-factory"],function(e,s,t,o,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends s.default{static shouldRender(e,{siteSettings:s,currentUser:t}){return s.user_notes_enabled&&t?.staff}get username(){return this.args.outletArgs?.reviewable?.target_created_by?.username||"user"}static{(0,o.setComponentTemplate)((0,r.createTemplateFactory)({id:"JenbGzNb",block:'[[[8,[30,1,["Field"]],null,[["@name","@title","@format"],["copy_note_to_user",[28,[32,0],["user_notes.copy_reviewable_note"],[["username"],[[30,0,["username"]]]]],"full"]],[["default"],[[[[1,"\\n  "],[8,[30,2,["Checkbox"]],null,null,null],[1,"\\n"]],[2]]]]]],["@form","field"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/reviewable-note-form-after-note/copy-reviewable-note-to-user-option.js",scope:()=>[t.i18n],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-user-notes/discourse/connectors/user-card-post-names/show-user-notes-on-card",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/helpers/d-icon","discourse/helpers/emoji","discourse-i18n","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/component","@ember/template-factory"],function(e,s,t,o,r,n,i,u,d,c,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends s.default{static shouldRender(e,{siteSettings:s,currentUser:t}){return s.user_notes_enabled&&t?.staff}static{dt7948.g(this.prototype,"siteSettings",[o.service])}#o=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"store",[o.service])}#s=void dt7948.i(this,"store")
get userNotesCount(){return parseInt(this.args.user.get("user_notes_count")||this.args.user.get("custom_fields.user_notes_count")||0,10)}showUserNotes(){(0,d.showUserNotes)(this.store,this.args.user.id)}static{dt7948.n(this.prototype,"showUserNotes",[t.action])}static{(0,c.setComponentTemplate)((0,l.createTemplateFactory)({id:"Wav3rTxT",block:'[[[10,0],[14,0,"show-user-notes-on-card"],[12],[1,"\\n"],[41,[30,0,["userNotesCount"]],[[[1,"    "],[8,[32,0],[[24,0,"btn-flat"]],[["@translatedTitle","@action"],[[28,[32,1],["user_notes.show"],[["count"],[[30,0,["userNotesCount"]]]]],[30,0,["showUserNotes"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["siteSettings","enable_emoji"]],[[[1,"        "],[1,[28,[32,2],["memo"],null]],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[32,3],["pen-to-square"],null]],[1,"\\n"]],[]]],[1,"    "]],[]]]]],[1,"\\n"]],[]],null],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/user-card-post-names/show-user-notes-on-card.js",scope:()=>[r.default,u.i18n,i.default,n.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-user-notes/discourse/connectors/user-profile-controls/show-notes-on-profile",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/plugins/discourse-user-notes/discourse/components/show-user-notes","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/component","@ember/template-factory"],function(e,s,t,o,r,n,i,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends s.default{static shouldRender(e,{siteSettings:s,currentUser:t}){return s.user_notes_enabled&&t?.staff}static{dt7948.g(this.prototype,"store",[r.service])}#s=void dt7948.i(this,"store")
static{dt7948.g(this.prototype,"userNotesCount",[t.tracked],function(){return this.args.model.user_notes_count||this.args.model.custom_fields?.user_notes_count||0})}#r=void dt7948.i(this,"userNotesCount")
showUserNotes(){(0,i.showUserNotes)(this.store,this.args.model.id,e=>this.userNotesCount=e)}static{dt7948.n(this.prototype,"showUserNotes",[o.action])}static{(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"8e86eYKl",block:'[[[10,"li"],[14,0,"user-profile-controls-outlet show-notes-on-profile"],[12],[1,"\\n  "],[8,[32,0],null,[["@show","@count"],[[30,0,["showUserNotes"]],[30,0,["userNotesCount"]]]],null],[1,"\\n"],[13]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/user-profile-controls/show-notes-on-profile.js",scope:()=>[n.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-user-notes/discourse/initializers/enable-user-notes",["exports","@glimmer/component","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/plugin-api","discourse/lib/transformer","discourse/plugins/discourse-user-notes/discourse/components/post-metadata-user-notes","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/component","@ember/template-factory"],function(e,s,t,o,r,n,i,u,d,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"enable-user-notes",initialize(e){const l=e.lookup("service:site-settings"),a=e.lookup("service:current-user")
l.user_notes_enabled&&a?.staff&&(0,r.withPluginApi)(r=>{(function(e,t){const o=t.lookup("service:site-settings"),r=(0,n.applyValueTransformer)("user-notes-icon-placement",o.user_notes_icon_placement)
class u extends s.default{static shouldRender(e){return e.post?.user_custom_fields?.user_notes_count>0}static{(0,d.setComponentTemplate)((0,c.createTemplateFactory)({id:"DqzJ1LLP",block:'[[[8,[32,0],null,[["@post"],[[30,1]]],null]],["@post"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-user-notes/discourse/initializers/enable-user-notes.js",scope:()=>[i.default],isStrictMode:!0}),this)}}if("avatar"===r)e.renderAfterWrapperOutlet("post-avatar",u)
else if("name"===r){class s extends u{static shouldRender(e,s){return s.site.mobileView&&super.shouldRender(e)}}class t extends u{static shouldRender(e,s){return!s.site.mobileView&&super.shouldRender(e)}}e.renderBeforeWrapperOutlet("post-meta-data-poster-name",s),e.renderAfterWrapperOutlet("post-meta-data-poster-name",t)}})(r,e),function(e,s){const t=s.lookup("service:store")
e.addPostAdminMenuButton(e=>({icon:"pen-to-square",label:"user_notes.attach",action:s=>{(0,u.showUserNotes)(t,e.user_id,e=>{(0,u.updatePostUserNotesCount)(s,e)},{postId:e.id})},secondaryAction:"closeAdminMenu",className:"add-user-note"}))}(r,e),function(e){e.onAppEvent("reviewablenote:created",async(e,s,r)=>{if(e.copy_note_to_user&&s.target_created_by)try{await(0,t.ajax)("/user_notes",{type:"POST",data:{user_note:{user_id:s.target_created_by.id,raw:e.content.trim(),reviewable_id:s.id}}}),r.set("copy_note_to_user",!1)}catch(n){(0,o.popupAjaxError)(n)}})}(r)})}}}),define("discourse/plugins/discourse-user-notes/discourse/lib/user-notes",["exports","discourse/lib/get-owner","discourse/plugins/discourse-user-notes/discourse/components/modal/user-notes"],function(e,s,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.showUserNotes=async function(e,o,r,n={}){const i=(0,s.getOwnerWithFallback)(this).lookup("service:modal"),u=await e.find("user-note",{user_id:o})
await i.show(t.default,{model:{note:u.content,userId:o,callback:r,postId:n.postId}})},e.updatePostUserNotesCount=function(e,s){e.user_custom_fields||={},e.user_custom_fields.user_notes_count=s}}),define("discourse/plugins/discourse-user-notes/discourse/pre-initializers/user-notes-transformers",["exports","discourse/lib/plugin-api"],function(e,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={before:"freeze-valid-transformers",initialize(){(0,s.withPluginApi)(e=>{e.addValueTransformerName("user-notes-icon-placement")})}}})

//# sourceMappingURL=discourse-user-notes-2461f902.map